<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¢é•¿å±æœºï¼šä»»åŠ¡æ¨¡å¼ | Mission Mode</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0F172A 0%, #020617 100%);
            color: #E2E8F0;
            min-height: 100vh;
            font-size: 16px;
            line-height: 1.6;
        }

        /* ä»»åŠ¡å¤´éƒ¨ */
        .mission-header {
            background: linear-gradient(135deg, #1E293B 0%, #0F172A 100%);
            border-bottom: 3px solid #A855F7;
            padding: 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 5px 30px rgba(168, 85, 247, 0.3);
        }

        .mission-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .mission-title {
            font-size: 1.8em;
            font-weight: 700;
            color: #A855F7;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
            animation: pulse 2s infinite;
            text-shadow: 0 0 20px rgba(168, 85, 247, 0.5);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .mission-objective {
            background: rgba(15, 23, 42, 0.8);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #06B6D4;
            margin-bottom: 15px;
        }

        .objective-text {
            font-size: 1.2em;
            font-weight: 600;
            color: #06B6D4;
            margin-bottom: 10px;
        }

        .objective-details {
            font-size: 0.95em;
            line-height: 1.6;
            color: #CBD5E1;
        }

        .mission-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .stat-box {
            background: rgba(15, 23, 42, 0.6);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(168, 85, 247, 0.3);
        }

        .stat-label {
            font-size: 0.85em;
            color: #94A3B8;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: 700;
            color: #10B981;
            text-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }

        .stat-value.critical {
            color: #FF4444;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* ä¸»æ¸¸æˆåŒº */
        .game-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .game-grid {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 20px;
        }

        /* åœºæ™¯åŒº */
        .scene-card {
            background: linear-gradient(135deg, #1E293B 0%, #0F172A 100%);
            border: 2px solid #475569;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(168, 85, 247, 0.1);
        }

        .scene-time {
            color: #06B6D4;
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #475569;
        }

        .scene-text {
            line-height: 1.8;
            white-space: pre-wrap;
        }

        /* è¡ŒåŠ¨é€‰æ‹© */
        .action-card {
            background: linear-gradient(135deg, #1E293B 0%, #0F172A 100%);
            border: 2px solid #475569;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(168, 85, 247, 0.1);
        }

        .action-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #A855F7;
            margin-bottom: 20px;
            text-align: center;
        }

        .actions-grid {
            display: grid;
            gap: 12px;
        }

        .action-btn {
            background: linear-gradient(135deg, #334155 0%, #1E293B 100%);
            border: 2px solid #475569;
            color: #E2E8F0;
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            position: relative;
        }

        .action-btn:hover:not(:disabled) {
            border-color: #A855F7;
            transform: scale(0.98);
            box-shadow: 0 0 30px rgba(168, 85, 247, 0.5), 0 0 60px rgba(168, 85, 247, 0.3);
        }

        .action-btn:active:not(:disabled) {
            transform: scale(0.95);
        }

        .action-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .action-name {
            font-size: 1.1em;
            font-weight: 700;
            color: #06B6D4;
            margin-bottom: 8px;
        }

        .action-desc {
            font-size: 0.9em;
            margin-bottom: 10px;
            line-height: 1.5;
            color: #CBD5E1;
        }

        .action-cost {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            color: #94A3B8;
        }

        .cost-time {
            color: #F59E0B;
        }

        /* ç»“æœå¼¹çª— */
        .result-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .result-overlay.show {
            display: flex;
            animation: fadeIn 0.3s;
        }

        .result-box {
            background: linear-gradient(135deg, #1E293B 0%, #0F172A 100%);
            border: 3px solid #A855F7;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            text-align: center;
            animation: zoomIn 0.5s;
            box-shadow: 0 0 60px rgba(168, 85, 247, 0.6);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes zoomIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .result-icon {
            font-size: 5em;
            margin-bottom: 20px;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .result-title {
            font-size: 3em;
            margin-bottom: 20px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .result-title.success {
            color: #10B981;
            text-shadow: 0 0 30px #10B981, 0 0 60px #10B981;
            animation: successGlow 1.5s ease-in-out infinite;
        }

        @keyframes successGlow {
            0%, 100% {
                text-shadow: 0 0 30px #10B981, 0 0 60px #10B981;
            }
            50% {
                text-shadow: 0 0 40px #10B981, 0 0 80px #10B981, 0 0 100px #10B981;
            }
        }

        .result-title.fail {
            color: #EF4444;
            text-shadow: 0 0 30px #EF4444, 0 0 60px #EF4444;
        }

        .result-text {
            font-size: 1.2em;
            line-height: 1.8;
            margin-bottom: 30px;
        }

        .result-btn {
            background: linear-gradient(135deg, #A855F7 0%, #7C3AED 100%);
            color: #FFF;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(168, 85, 247, 0.4);
        }

        .result-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(168, 85, 247, 0.8);
        }

        .result-btn:active {
            transform: scale(0.95);
        }

        /* èµ„æºç³»ç»Ÿæ ·å¼ */
        .resource-panel {
            background: linear-gradient(135deg, #2C1810 0%, #1A0F0A 100%);
            border: 2px solid #C9A961;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .resource-title {
            color: #FFD700;
            font-size: 1.1em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #C9A961;
            text-align: center;
        }

        .resource-bars {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .resource-item {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .resource-item.critical {
            border: 2px solid #FF4444;
            animation: warning-pulse 1s infinite;
        }

        .resource-item.empty {
            border: 2px solid #8B0000;
            opacity: 0.6;
        }

        @keyframes warning-pulse {
            0%, 100% { box-shadow: 0 0 5px rgba(255,68,68,0.5); }
            50% { box-shadow: 0 0 15px rgba(255,68,68,1); }
        }

        .resource-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .resource-label {
            font-size: 0.9em;
            color: #E8DCC4;
        }

        .resource-value {
            font-size: 1em;
            font-weight: bold;
            color: #FFD700;
        }

        .resource-bar-container {
            width: 100%;
            height: 8px;
            background: rgba(0,0,0,0.5);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 4px;
        }

        .resource-bar {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease, background-color 0.3s;
        }

        .resource-bar.resource-change {
            animation: bar-flash 0.3s;
        }

        @keyframes bar-flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .resource-hint {
            font-size: 0.75em;
            color: #C9A961;
            opacity: 0.7;
            line-height: 1.3;
        }

        /* äº‹ä»¶ç³»ç»Ÿæ ·å¼ */
        .event-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .event-overlay.show {
            display: flex;
            opacity: 1;
        }

        .event-modal {
            background: linear-gradient(135deg, #2C1810 0%, #1A0F0A 100%);
            border: 3px solid #C9A961;
            border-radius: 20px;
            max-width: 700px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modal-appear 0.5s;
        }

        @keyframes modal-appear {
            from {
                transform: scale(0.8) translateY(-50px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .event-header {
            padding: 30px;
            text-align: center;
            border-bottom: 2px solid #C9A961;
            position: relative;
        }

        .event-header.opportunity {
            background: linear-gradient(135deg, rgba(74,255,74,0.1) 0%, transparent 100%);
            border-bottom-color: #4AFF4A;
        }

        .event-header.crisis {
            background: linear-gradient(135deg, rgba(255,68,68,0.1) 0%, transparent 100%);
            border-bottom-color: #FF4444;
        }

        .event-header.milestone {
            background: linear-gradient(135deg, rgba(255,215,0,0.1) 0%, transparent 100%);
            border-bottom-color: #FFD700;
        }

        .event-icon {
            font-size: 4em;
            margin-bottom: 15px;
            animation: icon-bounce 1s infinite;
        }

        @keyframes icon-bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .event-type-badge {
            display: inline-block;
            padding: 5px 15px;
            background: rgba(201,169,97,0.3);
            border: 1px solid #C9A961;
            border-radius: 20px;
            font-size: 0.85em;
            margin-bottom: 10px;
        }

        .event-title {
            font-size: 1.8em;
            color: #FFD700;
            font-weight: bold;
            margin-top: 10px;
        }

        .event-body {
            padding: 30px;
        }

        .event-description {
            font-size: 1.1em;
            line-height: 1.8;
            margin-bottom: 20px;
            color: #E8DCC4;
        }

        .event-context {
            background: rgba(201,169,97,0.1);
            padding: 15px;
            border-radius: 10px;
            border-left: 3px solid #C9A961;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .event-choices {
            margin-top: 25px;
        }

        .choices-title {
            font-size: 1.2em;
            color: #FFD700;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .event-choice {
            background: linear-gradient(135deg, #3A2010 0%, #2A1810 100%);
            border: 2px solid #8B7355;
            padding: 18px;
            border-radius: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .event-choice:hover {
            border-color: #FFD700;
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(255,215,0,0.3);
        }

        .choice-header {
            margin-bottom: 10px;
        }

        .choice-label {
            font-weight: bold;
            color: #FFD700;
            margin-right: 8px;
            font-size: 1.1em;
        }

        .choice-text {
            color: #E8DCC4;
            font-size: 1em;
        }

        .choice-cost {
            font-size: 0.85em;
            color: #FF8844;
            margin-bottom: 5px;
        }

        .choice-success-rate {
            font-size: 0.85em;
            color: #4AFF4A;
        }

        .event-outcome {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #2C1810 0%, #1A0F0A 100%);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            animation: outcome-appear 0.5s;
        }

        @keyframes outcome-appear {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .event-outcome.success {
            background: linear-gradient(135deg, rgba(74,255,74,0.1) 0%, #2C1810 100%);
        }

        .event-outcome.fail {
            background: linear-gradient(135deg, rgba(255,68,68,0.1) 0%, #2C1810 100%);
        }

        .outcome-icon {
            font-size: 5em;
            margin-bottom: 20px;
        }

        .outcome-title {
            font-size: 2.5em;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 20px;
        }

        .outcome-text {
            font-size: 1.2em;
            line-height: 1.8;
            text-align: center;
            margin-bottom: 30px;
            color: #E8DCC4;
        }

        .outcome-close {
            background: linear-gradient(135deg, #C9A961 0%, #A08040 100%);
            color: #000;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
        }

        .outcome-close:hover {
            transform: scale(1.05);
        }

        /* ä¾§è¾¹æ  */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .sidebar-card {
            background: linear-gradient(135deg, #1E293B 0%, #0F172A 100%);
            border: 2px solid #475569;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(168, 85, 247, 0.1);
        }

        .sidebar-title {
            color: #06B6D4;
            font-size: 1.1em;
            font-weight: 700;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #475569;
        }

        .info-item {
            background: rgba(71, 85, 105, 0.2);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 3px solid #475569;
            cursor: default;
            transition: all 0.3s ease;
        }

        .info-item.locked {
            opacity: 0.3;
        }

        .info-item.unlocked {
            cursor: pointer;
        }

        .info-item.unlocked:hover {
            background: rgba(168, 85, 247, 0.2);
            transform: translateX(3px);
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.4);
            border-left-color: #A855F7;
        }

        .info-item.unlocked::after {
            content: ' ğŸ‘ï¸';
            float: right;
            opacity: 0.5;
        }

        .info-item.unlocked:hover::after {
            opacity: 1;
        }

        .consequence-item {
            background: rgba(239, 68, 68, 0.2);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 3px solid #EF4444;
            font-size: 0.9em;
        }

        /* è¡ŒåŠ¨åé¦ˆå¼¹çª— */
        .action-feedback {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            z-index: 9998;
            align-items: center;
            justify-content: center;
        }

        .action-feedback.show {
            display: flex;
            animation: fadeIn 0.3s;
        }

        .feedback-card {
            background: linear-gradient(135deg, #1E293B 0%, #0F172A 100%);
            border: 3px solid #06B6D4;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 0 50px rgba(6, 182, 212, 0.5);
            animation: slideDown 0.4s;
        }

        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .feedback-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #475569;
        }

        .feedback-icon-small {
            font-size: 2em;
        }

        .feedback-title-small {
            font-size: 1.3em;
            color: #06B6D4;
            font-weight: 700;
        }

        .feedback-content {
            line-height: 1.8;
            margin-bottom: 20px;
            white-space: pre-wrap;
        }

        .feedback-time {
            background: rgba(245, 158, 11, 0.2);
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid #F59E0B;
            margin-bottom: 20px;
        }

        .feedback-close {
            background: linear-gradient(135deg, #A855F7 0%, #7C3AED 100%);
            color: #FFF;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            font-size: 1.1em;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(168, 85, 247, 0.4);
        }

        .feedback-close:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(168, 85, 247, 0.8);
        }

        .feedback-close:active {
            transform: scale(0.95);
        }

        /* å¯¹è¯ç³»ç»Ÿ */
        .dialogue-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #475569;
        }

        .dialogue-content {
            text-align: left;
        }

        .dialogue-question {
            background: rgba(168, 85, 247, 0.15);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #A855F7;
            margin-bottom: 25px;
            font-size: 1.2em;
            line-height: 1.8;
        }

        .dialogue-option {
            background: linear-gradient(135deg, #334155 0%, #1E293B 100%);
            border: 2px solid #475569;
            padding: 18px;
            border-radius: 10px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .dialogue-option:hover {
            border-color: #A855F7;
            transform: scale(0.98);
            box-shadow: 0 0 30px rgba(168, 85, 247, 0.5);
        }

        .dialogue-option:active {
            transform: scale(0.95);
        }

        .dialogue-option.selected {
            background: linear-gradient(135deg, #065F46 0%, #064E3B 100%);
            border-color: #10B981;
            box-shadow: 0 0 30px rgba(16, 185, 129, 0.6);
            animation: successPulse 1s ease-in-out;
        }

        @keyframes successPulse {
            0% {
                box-shadow: 0 0 30px rgba(16, 185, 129, 0.6);
            }
            50% {
                box-shadow: 0 0 50px rgba(16, 185, 129, 0.9);
            }
            100% {
                box-shadow: 0 0 30px rgba(16, 185, 129, 0.6);
            }
        }

        .dialogue-option.wrong {
            background: linear-gradient(135deg, #7F1D1D 0%, #5B0F0F 100%);
            border-color: #EF4444;
        }

        .option-label {
            font-weight: 700;
            color: #06B6D4;
            margin-right: 10px;
        }

        .option-feedback {
            display: none;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255,255,255,0.2);
            font-size: 0.9em;
            line-height: 1.6;
        }

        .option-feedback.show {
            display: block;
        }

        @media (max-width: 968px) {
            .game-grid {
                grid-template-columns: 1fr;
            }
            .mission-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ä»»åŠ¡å¤´éƒ¨ -->
    <div class="mission-header">
        <div class="mission-container">
            <div class="mission-title">âš ï¸ å…³å¡ #1ï¼šæŠ•èµ„äººç”Ÿæ­»åŠ«</div>

            <div class="mission-objective">
                <div class="objective-text">ğŸ¯ ä»»åŠ¡ç›®æ ‡ï¼š3å°æ—¶å†…å‡†å¤‡å¥½æ•°æ®ï¼Œè¯´æœæŠ•èµ„äººç»§ç»­æ”¯æŒ</div>
                <div class="objective-details">
                    â° 12:00 æŠ•èµ„äººTomå°†æ¥ç”µï¼Œä½ å¿…é¡»ç»™å‡ºæœ‰è¯´æœåŠ›çš„ç­”æ¡ˆ<br>
                    âš ï¸ å¤±è´¥åæœï¼šèèµ„ç»ˆæ­¢ï¼Œå…¬å¸å¯èƒ½å…³é—¨<br>
                    âœ… æˆåŠŸæ¡ä»¶ï¼šåŸºäºæ•°æ®ç»™å‡ºæ­£ç¡®åˆ¤æ–­ï¼Œè®©Tomç›¸ä¿¡ä½ æœ‰æŒæ§åŠ›
                </div>
            </div>

            <div class="mission-stats">
                <div class="stat-box">
                    <div class="stat-label">â±ï¸ å‰©ä½™æ—¶é—´</div>
                    <div class="stat-value" id="time-left">3:00:00</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">ğŸ“Š å·²æ”¶é›†æƒ…æŠ¥</div>
                    <div class="stat-value" id="intel-count">0 / 6</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">ğŸ² å†³ç­–æœºä¼š</div>
                    <div class="stat-value" id="decision-chances">1æ¬¡</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸»æ¸¸æˆåŒº -->
    <div class="game-content">
        <div class="game-grid">
            <div class="main-panel">
                <!-- åœºæ™¯ -->
                <div class="scene-card">
                    <div class="scene-time">æ˜ŸæœŸä¸€ï¼Œæ—©ä¸Š9:17</div>
                    <div class="scene-text" id="scene-text">ä½ çš„æ‰‹æœºå“äº†ä¸‰æ¬¡ã€‚æ˜¯CEO Sarahã€‚

"ä¼šè®®å®¤ï¼Œç°åœ¨ã€‚Tomï¼ˆæŠ•èµ„äººï¼‰ä¹Ÿåœ¨ã€‚"

ä½ å¿«æ­¥èµ°è¿›å»ï¼Œç™½æ¿ä¸Šç”¨çº¢ç¬”å†™ç€ï¼š
æ˜¨æ™š8ç‚¹ï¼š10,000äºº
ä»Šæ—©8ç‚¹ï¼š5,000äººï¼ˆ-50%ï¼‰
å½“å‰æµå¤±é€Ÿåº¦ï¼š15%/å¤©

Tomçœ‹èµ·æ¥å¾ˆç„¦è™‘ï¼š"FitnessProæ˜¨æ™šå®£å¸ƒæ°¸ä¹…å…è´¹äº†ã€‚"

Sarahè¡¥å……ï¼š"æˆ‘ä»¬çš„å¥èº«Appè®¢é˜…æ˜¯$20/æœˆã€‚"

è´¢åŠ¡æ€»ç›‘Lisaèµ°è¿›æ¥ï¼Œé€’ç»™ä½ ä¸€å¼ çº¸ï¼š
"è´¦æˆ·ä½™é¢ï¼š$10,000"
"å›¢é˜Ÿ6äººï¼Œæœˆå·¥èµ„ï¼š$18,000"

Tomç«™èµ·æ¥ï¼š"æˆ‘12ç‚¹æœ‰ç”µè¯ä¼šï¼Œåˆ°æ—¶å€™é—®ä½ ä¸€ä¸ªé—®é¢˜ã€‚"

ä»–èµ°åˆ°é—¨å£ï¼Œå›å¤´ï¼š"ä½ æœ€å¥½æœ‰æ•°æ®æ”¯æ’‘çš„ç­”æ¡ˆã€‚"

<div style="color:#10B981;margin-top:15px;font-weight:600;">ç°åœ¨æ˜¯9:20ï¼Œä½ æœ‰2å°æ—¶40åˆ†é’Ÿå‡†å¤‡ã€‚</div></div>
                </div>

                <!-- è¡ŒåŠ¨é€‰æ‹© -->
                <div class="action-card">
                    <div class="action-title">é€‰æ‹©ä½ çš„è¡ŒåŠ¨ï¼ˆæ¯ä¸ªè¡ŒåŠ¨æ¶ˆè€—æ—¶é—´ï¼‰</div>
                    <div class="actions-grid" id="actions-grid">
                        <button class="action-btn" data-action-id="users" onclick="takeAction('users')">
                            <div class="action-name">ğŸ‘¥ æ·±æŒ–ç”¨æˆ·æ•°æ®</div>
                            <div class="action-desc">æŸ¥çœ‹ç”¨æˆ·æ„æˆã€æµå¤±æ˜ç»†ã€ä»˜è´¹è½¬åŒ–ç‡</div>
                            <div class="action-cost">
                                <span>ä»·å€¼ï¼šâ˜…â˜…â˜…â˜…â˜…</span>
                                <span class="cost-time">â±ï¸ è€—æ—¶ï¼š40åˆ†é’Ÿ</span>
                            </div>
                        </button>

                        <button class="action-btn" data-action-id="finance" onclick="takeAction('finance')">
                            <div class="action-name">ğŸ’° åˆ†æè´¢åŠ¡æŠ¥è¡¨</div>
                            <div class="action-desc">æ”¶å…¥ç»“æ„ã€æˆæœ¬æ˜ç»†ã€ç°é‡‘æµé¢„æµ‹</div>
                            <div class="action-cost">
                                <span>ä»·å€¼ï¼šâ˜…â˜…â˜…â˜…â˜†</span>
                                <span class="cost-time">â±ï¸ è€—æ—¶ï¼š30åˆ†é’Ÿ</span>
                            </div>
                        </button>

                        <button class="action-btn" data-action-id="competitor" onclick="takeAction('competitor')">
                            <div class="action-name">ğŸ¯ è°ƒç ”ç«å“ç­–ç•¥</div>
                            <div class="action-desc">åˆ†æç«å“çš„å…è´¹æ¨¡å¼ã€ç”¨æˆ·åé¦ˆ</div>
                            <div class="action-cost">
                                <span>ä»·å€¼ï¼šâ˜…â˜…â˜…â˜†â˜†</span>
                                <span class="cost-time">â±ï¸ è€—æ—¶ï¼š50åˆ†é’Ÿ</span>
                            </div>
                        </button>

                        <button class="action-btn" data-action-id="meeting" onclick="takeAction('meeting')">
                            <div class="action-name">ğŸ’¬ å¬é›†å›¢é˜Ÿä¼šè®®</div>
                            <div class="action-desc">è®¨è®ºåº”å¯¹ç­–ç•¥ï¼Œç¨³å®šå›¢é˜Ÿæƒ…ç»ª</div>
                            <div class="action-cost">
                                <span>ä»·å€¼ï¼šâ˜…â˜…â˜†â˜†â˜†</span>
                                <span class="cost-time">â±ï¸ è€—æ—¶ï¼š90åˆ†é’Ÿ</span>
                            </div>
                        </button>

                        <button class="action-btn" data-action-id="calc" onclick="takeAction('calc')">
                            <div class="action-name">ğŸ“Š è®¡ç®—ç”Ÿå­˜æ—¶é—´</div>
                            <div class="action-desc">è¯¦ç»†è®¡ç®—ç°é‡‘æµã€Unit Economics</div>
                            <div class="action-cost">
                                <span>ä»·å€¼ï¼šâ˜…â˜…â˜…â˜…â˜…</span>
                                <span class="cost-time">â±ï¸ è€—æ—¶ï¼š35åˆ†é’Ÿ</span>
                            </div>
                        </button>

                        <button class="action-btn" data-action-id="ppt" onclick="takeAction('ppt')">
                            <div class="action-name">ğŸ“„ å‡†å¤‡æ±‡æŠ¥PPT</div>
                            <div class="action-desc">åšä¸€ä»½æ¼‚äº®çš„å±•ç¤ºæ–‡æ¡£</div>
                            <div class="action-cost">
                                <span>ä»·å€¼ï¼šâ˜…â˜†â˜†â˜†â˜†</span>
                                <span class="cost-time">â±ï¸ è€—æ—¶ï¼š60åˆ†é’Ÿ</span>
                            </div>
                        </button>
                    </div>

                    <div style="margin-top:20px;padding:15px;background:rgba(139,0,0,0.2);border-radius:10px;text-align:center;">
                        <button class="result-btn" onclick="readyToAnswer()" id="ready-btn" disabled style="opacity:0.5;">
                            æˆ‘å‡†å¤‡å¥½å›ç­”äº†
                        </button>
                        <div style="font-size:0.85em;margin-top:10px;color:#C9A961;">
                            è‡³å°‘å®Œæˆ2é¡¹è°ƒæŸ¥æ‰èƒ½å°è¯•å›ç­”
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¾§è¾¹æ  -->
            <div class="sidebar">
                <!-- èµ„æºé¢æ¿ -->
                <div id="resource-container"></div>

                <div class="sidebar-card">
                    <div class="sidebar-title">ğŸ“‹ å·²æ”¶é›†æƒ…æŠ¥</div>
                    <div id="intel-list">
                        <div class="info-item locked" data-action="users">ç”¨æˆ·æ•°æ®åˆ†æ</div>
                        <div class="info-item locked" data-action="finance">è´¢åŠ¡æŠ¥è¡¨</div>
                        <div class="info-item locked" data-action="competitor">ç«å“è°ƒç ”</div>
                        <div class="info-item locked" data-action="meeting">å›¢é˜Ÿæ„è§</div>
                        <div class="info-item locked" data-action="calc">ç”Ÿå­˜è®¡ç®—</div>
                        <div class="info-item locked" data-action="ppt">æ±‡æŠ¥ææ–™</div>
                    </div>
                    <div style="font-size:0.8em;margin-top:10px;color:#C9A961;opacity:0.7;">
                        ğŸ’¡ ç‚¹å‡»å·²è§£é”é¡¹ç›®å¯é‡æ–°æŸ¥çœ‹
                    </div>
                </div>

                <div class="sidebar-card">
                    <div class="sidebar-title">âš ï¸ æ—¶é—´åæœ</div>
                    <div class="consequence-item">
                        è¶…è¿‡3å°æ—¶ â†’ Tomæ¥ç”µæ—¶ä½ è¿˜æ²¡å‡†å¤‡å¥½ â†’ ç«‹å³FAIL
                    </div>
                    <div class="consequence-item">
                        å‡†å¤‡ä¸è¶³ï¼ˆ<2é¡¹è°ƒæŸ¥ï¼‰â†’ æ— æ³•ç»™å‡ºæœ‰è¯´æœåŠ›çš„ç­”æ¡ˆ â†’ FAIL
                    </div>
                    <div class="consequence-item">
                        æµªè´¹æ—¶é—´åœ¨ä½ä»·å€¼è¡ŒåŠ¨ä¸Š â†’ é”™è¿‡å…³é”®ä¿¡æ¯ â†’ FAIL
                    </div>
                </div>

                <div class="sidebar-card">
                    <div class="sidebar-title">ğŸ’¡ ç”Ÿå­˜æç¤º</div>
                    <div style="font-size:0.9em;line-height:1.6;">
                        â€¢ æ—¶é—´æœ‰é™ï¼Œé€‰æ‹©æœ€å…³é”®çš„è°ƒæŸ¥<br>
                        â€¢ æŠ•èµ„äººè¦çš„æ˜¯æ•°æ®ï¼Œä¸æ˜¯PPT<br>
                        â€¢ å¼€ä¼šä¸å¦‚è‡ªå·±åˆ†ææ•°æ®<br>
                        â€¢ ä½ åªæœ‰ä¸€æ¬¡å›ç­”æœºä¼š
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- è¡ŒåŠ¨åé¦ˆå¼¹çª— -->
    <div class="action-feedback" id="action-feedback">
        <div class="feedback-card">
            <div class="feedback-header">
                <div class="feedback-icon-small" id="feedback-icon">âœ…</div>
                <div class="feedback-title-small" id="feedback-title">è¡ŒåŠ¨å®Œæˆ</div>
            </div>
            <div class="feedback-content" id="feedback-content">
                å†…å®¹åŠ è½½ä¸­...
            </div>
            <div class="feedback-time" id="feedback-time">
                â±ï¸ è€—æ—¶ï¼š30åˆ†é’Ÿ
            </div>
            <button class="feedback-close" onclick="closeFeedback()">æ˜ç™½äº†</button>
        </div>
    </div>

    <!-- å¯¹è¯å¼¹çª— -->
    <div class="result-overlay" id="dialogue-overlay">
        <div class="result-box" style="max-width: 700px;">
            <div class="dialogue-header">
                <div style="font-size:3em;">â˜ï¸</div>
                <div style="font-size:1.5em;color:#FFD700;margin-top:10px;">Tomæ¥ç”µ</div>
                <div style="font-size:0.9em;color:#C9A961;margin-top:5px;" id="dialogue-timer">12:00 PM</div>
            </div>
            <div class="dialogue-content">
                <div class="dialogue-question" id="dialogue-question">
                    Tomï¼š"æˆ‘ä»¬èƒ½æ’‘è¿‡è¿™æ¬¡å±æœºå—ï¼Ÿ"
                </div>
                <div class="dialogue-options" id="dialogue-options">
                    <!-- é€‰é¡¹ä¼šåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <!-- ç»“æœå¼¹çª— -->
    <div class="result-overlay" id="result-overlay">
        <div class="result-box">
            <div class="result-icon" id="result-icon">ğŸ‰</div>
            <div class="result-title" id="result-title">SUCCESS</div>
            <div class="result-text" id="result-text">
                æ­å–œé€šè¿‡ç¬¬ä¸€å…³ï¼
            </div>
            <button class="result-btn" onclick="nextLevel()">ä¸‹ä¸€å…³</button>
            <button class="result-btn" onclick="restart()">é‡æ–°æŒ‘æˆ˜</button>
        </div>
    </div>

    <!-- åŠ è½½å…³å¡æ•°æ® -->
    <script src="levels-data.js"></script>

    <!-- åŠ è½½æ–°æ‰‹å¼•å¯¼ç³»ç»Ÿ -->
    <script src="onboarding.js"></script>

    <!-- åŠ è½½èµ„æºç³»ç»Ÿ -->
    <script src="resource-system.js"></script>

    <!-- åŠ è½½äº‹ä»¶ç³»ç»Ÿ -->
    <script src="event-system.js"></script>

    <script>
        // ç¡®ä¿æ•°æ®åŠ è½½å®Œæˆ
        if (typeof LEVELS_DATA === 'undefined') {
            alert('å…³å¡æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢');
            throw new Error('LEVELS_DATA not loaded');
        }

        // å…³å¡è¿›åº¦
        let currentLevel = parseInt(localStorage.getItem('currentLevel') || '0');

        // ç¡®ä¿å…³å¡ç´¢å¼•æœ‰æ•ˆ
        if (currentLevel >= LEVELS_DATA.length) {
            currentLevel = 0;
            localStorage.setItem('currentLevel', '0');
        }

        let levelData = LEVELS_DATA[currentLevel];

        // æ¸¸æˆçŠ¶æ€
        let timeRemaining = levelData.timeLimit;
        let intelCollected = 0;
        let actionsCompleted = [];
        let timerInterval;
        let currentQuestion = 0;
        let correctAnswers = 0;
        let totalQuestions = levelData.questions.length;
        let shouldRestartAfterFeedback = false;

        // åˆå§‹åŒ–èµ„æºç³»ç»Ÿå’Œäº‹ä»¶ç³»ç»Ÿ
        let resourceSystem = null;
        let resourceUI = null;
        let eventSystem = null;
        let eventUI = null;
        let weekCount = 0; // å‘¨è®¡æ•°


        // æ˜¾ç¤ºåé¦ˆå¼¹çª—
        function showFeedback(icon, title, content, time) {
            document.getElementById('feedback-icon').textContent = icon;
            document.getElementById('feedback-title').textContent = title;
            document.getElementById('feedback-content').textContent = content;
            document.getElementById('feedback-time').innerHTML = time;
            document.getElementById('action-feedback').classList.add('show');
        }

        // å…³é—­åé¦ˆå¼¹çª—
        function closeFeedback() {
            document.getElementById('action-feedback').classList.remove('show');

            // å¦‚æœéœ€è¦é‡å¯æ¸¸æˆ
            if (shouldRestartAfterFeedback) {
                shouldRestartAfterFeedback = false;
                setTimeout(() => restart(), 300);
            }
        }

        // è¡ŒåŠ¨æ•°æ®ï¼ˆä»å…³å¡æ•°æ®åŠ¨æ€åŠ è½½ï¼‰
        let actions = {};

        // åˆå§‹åŒ–å…³å¡
        function initLevel() {
            console.log('Initializing level:', currentLevel);
            levelData = LEVELS_DATA[currentLevel];
            console.log('Level data:', levelData);

            timeRemaining = levelData.timeLimit;
            totalQuestions = levelData.questions.length;

            // æ„å»ºactionså¯¹è±¡
            actions = {};
            levelData.actions.forEach(action => {
                actions[action.id] = {
                    time: action.time,
                    value: action.value,
                    name: action.name,
                    critical: action.critical
                };
            });

            console.log('Actions built:', actions);

            // åˆå§‹åŒ–èµ„æºç³»ç»Ÿ
            initResourceSystem();

            // åˆå§‹åŒ–äº‹ä»¶ç³»ç»Ÿ
            initEventSystem();

            // æ›´æ–°UI
            updateLevelUI();

            // é‡ç½®æ¸¸æˆçŠ¶æ€
            intelCollected = 0;
            actionsCompleted = [];
            currentQuestion = 0;
            correctAnswers = 0;
            weekCount = 0;

            console.log('Level initialized successfully');
        }

        // åˆå§‹åŒ–èµ„æºç³»ç»Ÿ
        function initResourceSystem() {
            if (typeof ResourceSystem === 'undefined') {
                console.warn('ResourceSystem not loaded, skipping resource initialization');
                return;
            }

            resourceSystem = new ResourceSystem();

            // è®¾ç½®åˆå§‹èµ„æºå€¼ï¼ˆåŸºäºå…³å¡ï¼‰
            resourceSystem.set('cash', 10000, 'å…³å¡åˆå§‹åŒ–');
            resourceSystem.set('time', levelData.timeLimit, 'å…³å¡åˆå§‹åŒ–');
            resourceSystem.set('energy', 100, 'å…³å¡åˆå§‹åŒ–');
            resourceSystem.set('trust', 80, 'å…³å¡åˆå§‹åŒ–');
            resourceSystem.set('reputation', 60, 'å…³å¡åˆå§‹åŒ–');

            // åˆ›å»ºèµ„æºUI
            resourceUI = new ResourceUI(resourceSystem, 'resource-container');

            // ç›‘å¬ä¸´ç•Œå€¼äº‹ä»¶
            resourceSystem.on('onCritical', (data) => {
                showFeedback('âš ï¸', `${data.resource.name}å‘Šæ€¥ï¼`,
                    `ä½ çš„${data.resource.name}å·²é™è‡³ä¸´ç•Œå€¼ï¼\nå½“å‰ï¼š${data.value}${data.resource.unit}\nä¸´ç•Œå€¼ï¼š${data.critical}${data.resource.unit}\n\nè¯·è°¨æ…è¡ŒåŠ¨ï¼Œé¿å…èµ„æºè€—å°½ï¼`,
                    '');
            });

            // ç›‘å¬èµ„æºè€—å°½äº‹ä»¶
            resourceSystem.on('onEmpty', (data) => {
                if (data.type === 'cash') {
                    // ç°é‡‘è€—å°½ -> æ¸¸æˆå¤±è´¥
                    clearInterval(timerInterval);
                    showResult(false, 'ğŸ’° èµ„é‡‘é“¾æ–­è£‚ï¼\n\nå…¬å¸è´¦æˆ·ä½™é¢ä¸º0ï¼Œæ— æ³•æ”¯ä»˜å‘˜å·¥å·¥èµ„ã€‚\nå›¢é˜Ÿå®£å¸ƒè§£æ•£ã€‚\n\næ¸¸æˆå¤±è´¥ï¼');
                } else if (data.type === 'trust') {
                    // ä¿¡ä»»è€—å°½ -> æ¸¸æˆå¤±è´¥
                    clearInterval(timerInterval);
                    showResult(false, 'ğŸ’” ä¿¡ä»»å´©å¡Œï¼\n\nå›¢é˜Ÿå’ŒæŠ•èµ„äººå¯¹ä½ å®Œå…¨å¤±å»ä¿¡ä»»ã€‚\næ ¸å¿ƒæˆå‘˜çº·çº·ç¦»èŒã€‚\n\næ¸¸æˆå¤±è´¥ï¼');
                } else if (data.type === 'energy') {
                    // ç²¾åŠ›è€—å°½ -> å¼ºåˆ¶ä¼‘æ¯
                    showFeedback('ğŸ˜°', 'ç²¾ç–²åŠ›ç«­',
                        'ä½ å·²ç»ç­‹ç–²åŠ›å°½ï¼Œæ— æ³•ç»§ç»­å·¥ä½œã€‚\n\nå¼ºåˆ¶ä¼‘æ¯30åˆ†é’Ÿ...',
                        'â±ï¸ å¼ºåˆ¶ä¼‘æ¯ï¼š30åˆ†é’Ÿ');
                    resourceSystem.consume('time', 30, 'ç²¾åŠ›è€—å°½å¼ºåˆ¶ä¼‘æ¯');
                    resourceSystem.gain('energy', 50, 'ä¼‘æ¯æ¢å¤');
                }
            });

            console.log('Resource system initialized');
        }

        // åˆå§‹åŒ–äº‹ä»¶ç³»ç»Ÿ
        function initEventSystem() {
            if (typeof EventSystem === 'undefined') {
                console.warn('EventSystem not loaded, skipping event initialization');
                return;
            }

            eventSystem = new EventSystem(resourceSystem);
            eventUI = new EventUI(eventSystem, 'event-overlay-main');

            console.log('Event system initialized');
        }

        // å°è¯•è§¦å‘éšæœºäº‹ä»¶ï¼ˆæ¯å‘¨30%æ¦‚ç‡ï¼‰
        function tryTriggerRandomEvent() {
            if (!eventSystem) return;

            weekCount++;

            // æ¯ä¸ªè¡ŒåŠ¨ç®—ä½œä¸€å‘¨çš„å·¥ä½œ
            const event = eventSystem.tryTriggerEvent();
            if (event) {
                console.log('Random event triggered:', event.title);
            }
        }

        // æ›´æ–°å…³å¡UI
        function updateLevelUI() {
            // æ›´æ–°æ ‡é¢˜ï¼ˆæ·»åŠ è¿›åº¦æ˜¾ç¤ºï¼‰
            document.querySelector('.mission-title').innerHTML = levelData.title + ` <span style="font-size:0.6em;opacity:0.7;">(${currentLevel + 1}/3)</span>`;
            document.querySelector('.objective-text').innerHTML = levelData.objective;
            document.querySelector('.objective-details').innerHTML = levelData.details;

            // æ›´æ–°åœºæ™¯
            document.querySelector('.scene-time').textContent = levelData.scene.time;
            document.getElementById('scene-text').innerHTML = levelData.scene.text;

            // æ›´æ–°è¡ŒåŠ¨æŒ‰é’®
            const actionsGrid = document.getElementById('actions-grid');
            actionsGrid.innerHTML = levelData.actions.map(action => `
                <button class="action-btn" data-action-id="${action.id}" onclick="takeAction('${action.id}')">
                    <div class="action-name">${action.name}</div>
                    <div class="action-desc">${action.desc}</div>
                    <div class="action-cost">
                        <span>ä»·å€¼ï¼š${'â˜…'.repeat(action.value)}${'â˜†'.repeat(5-action.value)}</span>
                        <span class="cost-time">â±ï¸ è€—æ—¶ï¼š${action.time}åˆ†é’Ÿ</span>
                    </div>
                </button>
            `).join('');

            // æ›´æ–°æƒ…æŠ¥åˆ—è¡¨
            const intelList = document.getElementById('intel-list');
            intelList.innerHTML = levelData.actions.map(action => `
                <div class="info-item locked" data-action="${action.id}">${action.name.split(' ')[1] || action.name}</div>
            `).join('');

            // æ›´æ–°æ—¶é—´æ˜¾ç¤º
            const hours = Math.floor(timeRemaining / 60);
            const minutes = timeRemaining % 60;
            document.getElementById('time-left').textContent = `${hours}:${minutes.toString().padStart(2, '0')}:00`;
            document.getElementById('intel-count').textContent = `0 / ${levelData.actions.length}`;
        }

        // å¯åŠ¨è®¡æ—¶å™¨
        function startTimer() {
            timerInterval = setInterval(() => {
                timeRemaining--;

                // åŒæ­¥èµ„æºç³»ç»Ÿçš„æ—¶é—´
                if (resourceSystem) {
                    resourceSystem.set('time', timeRemaining, 'æ—¶é—´æµé€');
                }

                updateTimer();

                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    timeOut();
                }

                // ä¸´ç•Œæ—¶é—´è­¦å‘Š
                if (timeRemaining === 30) {
                    showFeedback('â°', 'æ—¶é—´è­¦å‘Š', 'åªå‰©30åˆ†é’Ÿäº†ï¼\næŠ“ç´§æ—¶é—´å®Œæˆå…³é”®è°ƒæŸ¥ï¼', '');
                }

                // æ¯60ç§’ï¼ˆæ¸¸æˆå†…1å°æ—¶ï¼‰æ¢å¤å°‘é‡ç²¾åŠ›
                if (resourceSystem && timeRemaining % 60 === 0) {
                    resourceSystem.gain('energy', 5, 'æ—¶é—´æ¢å¤');
                }
            }, 1000); // ä¸ºäº†æ¼”ç¤ºï¼Œ1ç§’=1åˆ†é’Ÿ
        }

        // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
        function updateTimer() {
            const hours = Math.floor(timeRemaining / 60);
            const minutes = timeRemaining % 60;
            const seconds = 0; // ç®€åŒ–æ˜¾ç¤º
            document.getElementById('time-left').textContent =
                `${hours}:${minutes.toString().padStart(2, '0')}:00`;

            // æ—¶é—´ç´§å¼ æ—¶å˜çº¢
            if (timeRemaining < 30) {
                document.getElementById('time-left').classList.add('critical');
            }
        }

        // æ‰§è¡Œè¡ŒåŠ¨
        function takeAction(actionId) {
            console.log('takeAction called with:', actionId);
            console.log('actions object:', actions);

            if (actionsCompleted.includes(actionId)) {
                showFeedback('âš ï¸', 'é‡å¤æ“ä½œ', 'ä½ å·²ç»åšè¿‡è¿™ä¸ªè°ƒæŸ¥äº†', '');
                return;
            }

            const action = actions[actionId];

            if (!action) {
                console.error('Action not found:', actionId);
                showFeedback('âŒ', 'é”™è¯¯', 'æ‰¾ä¸åˆ°è¯¥æ“ä½œæ•°æ®ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', '');
                return;
            }

            // æ£€æŸ¥æ—¶é—´
            if (timeRemaining < action.time) {
                showFeedback('â°', 'æ—¶é—´ä¸è¶³',
                    `è¿™ä¸ªè¡ŒåŠ¨éœ€è¦${action.time}åˆ†é’Ÿ\nä½†ä½ åªå‰©${timeRemaining}åˆ†é’Ÿ\n\nè¯·é€‰æ‹©æ›´çŸ­çš„è¡ŒåŠ¨ï¼Œæˆ–ç›´æ¥å‡†å¤‡å›ç­”ï¼`,
                    '');
                return;
            }

            // ä½¿ç”¨èµ„æºç³»ç»Ÿæ¶ˆè€—èµ„æº
            if (resourceSystem) {
                const resourceCost = {
                    time: action.time,
                    energy: Math.floor(action.time / 3) // æ¯3åˆ†é’Ÿæ¶ˆè€—1ç‚¹ç²¾åŠ›
                };

                const affordCheck = resourceSystem.canAfford(resourceCost);
                if (!affordCheck.canAfford) {
                    const insufficient = affordCheck.insufficient.map(item => {
                        const res = resourceSystem.getResource(item.type);
                        return `${res.name}ä¸è¶³ï¼ˆéœ€è¦${item.required}ï¼Œå½“å‰${item.current}ï¼‰`;
                    }).join('\n');
                    showFeedback('âš ï¸', 'èµ„æºä¸è¶³', insufficient, '');
                    return;
                }

                // æ‰§è¡Œèµ„æºæ¶ˆè€—
                resourceSystem.consumeMultiple(resourceCost, `è¡ŒåŠ¨: ${action.name}`);
            } else {
                // å…¼å®¹æ¨¡å¼ï¼šæ²¡æœ‰èµ„æºç³»ç»Ÿæ—¶ç›´æ¥æ¶ˆè€—æ—¶é—´
                timeRemaining -= action.time;
            }

            updateTimer();

            // æ ‡è®°å®Œæˆ
            actionsCompleted.push(actionId);
            intelCollected++;

            // æ›´æ–°UI
            document.getElementById('intel-count').textContent = `${intelCollected} / ${levelData.actions.length}`;
            const intelList = document.getElementById('intel-list').children;
            const index = Object.keys(actions).indexOf(actionId);
            intelList[index].classList.remove('locked');
            intelList[index].classList.add('unlocked');
            intelList[index].style.borderLeftColor = action.critical ? '#4AFF4A' : '#C9A961';

            // ç¦ç”¨æŒ‰é’®
            const buttonElement = document.querySelector(`button[data-action-id="${actionId}"]`);
            if (buttonElement) {
                buttonElement.disabled = true;
                buttonElement.style.opacity = '0.5';
            }

            // å°è¯•è§¦å‘éšæœºäº‹ä»¶
            tryTriggerRandomEvent();

            // æ˜¾ç¤ºåé¦ˆ
            showActionFeedback(actionId);

            // æ£€æŸ¥æ˜¯å¦å¯ä»¥å›ç­”
            if (intelCollected >= 2) {
                document.getElementById('ready-btn').disabled = false;
                document.getElementById('ready-btn').style.opacity = '1';
            }
        }

        // æ˜¾ç¤ºè¡ŒåŠ¨åé¦ˆ
        function showActionFeedback(actionId) {
            const action = levelData.actions.find(a => a.id === actionId);
            const icon = action.critical ? 'âœ…' : (action.value <= 2 ? 'âš ï¸' : 'âœ…');

            showFeedback(
                icon,
                `${action.name}å®Œæˆ`,
                action.feedback,
                `â±ï¸ è€—æ—¶ï¼š${action.time}åˆ†é’Ÿ | å‰©ä½™ï¼š${timeRemaining}åˆ†é’Ÿ`
            );
        }

        // å‡†å¤‡å¥½å›ç­”
        function readyToAnswer() {
            clearInterval(timerInterval);

            // æ£€æŸ¥æœ€ä½è¦æ±‚
            if (intelCollected < 2) {
                showResult(false,
                    `å‡†å¤‡ä¸è¶³ï¼\n\nä½ åªæ”¶é›†äº†${intelCollected}é¡¹æƒ…æŠ¥ï¼Œè¿åŸºæœ¬é—®é¢˜éƒ½æ— æ³•å›ç­”ï¼\n\nTomé—®äº†å‡ ä¸ªé—®é¢˜ï¼Œä½ æ”¯æ”¯å¾å¾ç­”ä¸ä¸Šæ¥...\n\nç»“æœï¼šTomå†³å®šåœæ­¢æŠ•èµ„ã€‚`
                );
                return;
            }

            // å¼€å§‹å¯¹è¯
            startDialogue();
        }

        // å¼€å§‹å¯¹è¯
        function startDialogue() {
            currentQuestion = 0;
            correctAnswers = 0;
            document.getElementById('dialogue-overlay').classList.add('show');
            showQuestion();
        }

        // æ˜¾ç¤ºé—®é¢˜
        function showQuestion() {
            if (currentQuestion >= levelData.questions.length) {
                // æ‰€æœ‰é—®é¢˜å›ç­”å®Œæ¯•ï¼Œæ˜¾ç¤ºç»“æœ
                evaluatePerformance();
                return;
            }

            const q = levelData.questions[currentQuestion];
            document.getElementById('dialogue-question').innerHTML = q.question;

            const optionsHtml = q.options.map((opt, index) => {
                const letter = String.fromCharCode(65 + index); // A, B, C, D
                return `
                    <div class="dialogue-option" onclick="selectAnswer(${currentQuestion}, ${index})">
                        <span class="option-label">${letter}.</span>
                        <span class="option-text">${opt.text}</span>
                        <div class="option-feedback" id="feedback-${currentQuestion}-${index}">
                            ${opt.feedback}
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('dialogue-options').innerHTML = optionsHtml;
        }

        // é€‰æ‹©ç­”æ¡ˆ
        function selectAnswer(questionIndex, optionIndex) {
            const q = levelData.questions[questionIndex];
            const selectedOption = q.options[optionIndex];

            // ç¦ç”¨æ‰€æœ‰é€‰é¡¹
            const allOptions = document.querySelectorAll('.dialogue-option');
            allOptions.forEach(opt => {
                opt.style.pointerEvents = 'none';
                opt.style.opacity = '0.6';
            });

            // é«˜äº®é€‰ä¸­çš„é€‰é¡¹
            const selectedElement = allOptions[optionIndex];
            selectedElement.style.opacity = '1';
            selectedElement.classList.add(selectedOption.correct ? 'selected' : 'wrong');

            // æ˜¾ç¤ºåé¦ˆ
            const feedbackElement = document.getElementById(`feedback-${questionIndex}-${optionIndex}`);
            feedbackElement.classList.add('show');

            // è®°å½•åˆ†æ•°
            if (selectedOption.correct) {
                correctAnswers++;
            }

            // 2ç§’åæ˜¾ç¤ºä¸‹ä¸€é¢˜
            setTimeout(() => {
                currentQuestion++;
                showQuestion();
            }, 3500);
        }

        // è¯„ä¼°è¡¨ç°
        function evaluatePerformance() {
            document.getElementById('dialogue-overlay').classList.remove('show');

            const score = correctAnswers / totalQuestions;
            const timeUsed = 180 - timeRemaining;

            if (score === 1) {
                // å…¨å¯¹
                showResult(true,
                    `å®Œç¾ï¼ä½ åœ¨${timeUsed}åˆ†é’Ÿå†…å®Œæˆäº†å…³é”®è°ƒæŸ¥ï¼\n\nå¯¹è¯è¡¨ç°ï¼š${correctAnswers}/${totalQuestions}é¢˜å…¨å¯¹\n\nä½ å±•ç°äº†ï¼š\nâœ“ æ•°æ®é©±åŠ¨çš„å†³ç­–èƒ½åŠ›\nâœ“ ç²¾å‡†çš„è´¢åŠ¡åˆ†æ\nâœ“ æ¸…æ™°çš„æˆ˜ç•¥åˆ¤æ–­\n\nTomæ»¡æ„åœ°è¯´ï¼š"å¾ˆå¥½ï¼Œä½ æœ‰æŒæ§åŠ›ã€‚ç»§ç»­å¹²ï¼Œæˆ‘ä¼šç»§ç»­æ”¯æŒä½ ï¼"\n\nğŸ’° æŠ•èµ„ç»§ç»­ï¼`
                );
            } else if (score >= 0.66) {
                // 2/3å¯¹
                showResult(true,
                    `é€šè¿‡ï¼ä½†æœ‰å¾…æé«˜ã€‚\n\nå¯¹è¯è¡¨ç°ï¼š${correctAnswers}/${totalQuestions}é¢˜æ­£ç¡®\n\nTomç•¥æ˜¾çŠ¹è±«ï¼š"è¿˜è¡Œ...ä½†ä½ éœ€è¦æ›´å…¨é¢åœ°æ”¶é›†ä¿¡æ¯ã€‚æˆ‘ä¼šå†ç»™ä½ ä¸€æ¬¡æœºä¼šã€‚"\n\nâš ï¸ å‹‰å¼ºé€šè¿‡ï¼Œä¸‹æ¬¡è¦åšå¾—æ›´å¥½ï¼`
                );
            } else {
                // å¤±è´¥
                const wastedTime = actionsCompleted.includes('meeting') && actionsCompleted.includes('ppt');
                let reason = '';
                if (wastedTime) {
                    reason = '\n\nä½ æµªè´¹äº†å¤ªå¤šæ—¶é—´åœ¨å¼€ä¼šå’ŒåšPPTä¸Šï¼Œ\næ²¡æœ‰æ”¶é›†åˆ°å…³é”®æ•°æ®ï¼';
                } else {
                    reason = '\n\nä½ æ”¶é›†çš„æƒ…æŠ¥ä¸å¤Ÿå…³é”®ï¼Œ\næ— æ³•å›ç­”Tomçš„æ ¸å¿ƒé—®é¢˜ï¼';
                }

                showResult(false,
                    `å¤±è´¥ï¼\n\nå¯¹è¯è¡¨ç°ï¼š${correctAnswers}/${totalQuestions}é¢˜æ­£ç¡®${reason}\n\nTomå¤±æœ›åœ°è¯´ï¼š"ä½ æ²¡æœ‰å±•ç°å‡ºå¢é•¿è´Ÿè´£äººåº”æœ‰çš„æ•°æ®èƒ½åŠ›ã€‚æˆ‘éœ€è¦é‡æ–°è€ƒè™‘è¿™ç¬”æŠ•èµ„ã€‚"\n\nğŸ’” æŠ•èµ„ç»ˆæ­¢ã€‚`
                );
            }
        }

        // æ—¶é—´åˆ°
        function timeOut() {
            showResult(false,
                `â° æ—¶é—´åˆ°ï¼\n\n12:00ï¼ŒTomçš„ç”µè¯æ¥äº†...\nä½†ä½ è¿˜æ²¡å‡†å¤‡å¥½ï¼\n\nTomï¼š"æˆ‘éœ€è¦ä½ çš„åˆ¤æ–­ã€‚"\nä½ ï¼š"å‘ƒï¼Œæˆ‘è¿˜åœ¨æ•´ç†..."\n\nTomæŒ‚æ–­äº†ç”µè¯ã€‚\n\nç¬¬äºŒå¤©ï¼Œä½ æ”¶åˆ°é‚®ä»¶ï¼š\n"æŠ•èµ„ç»ˆæ­¢ã€‚"`
            );
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(success, text) {
            const overlay = document.getElementById('result-overlay');
            const icon = document.getElementById('result-icon');
            const title = document.getElementById('result-title');
            const resultText = document.getElementById('result-text');

            if (success) {
                icon.textContent = 'ğŸ‰';
                title.textContent = 'SUCCESS';
                title.className = 'result-title success';
            } else {
                icon.textContent = 'ğŸ’€';
                title.textContent = 'FAIL';
                title.className = 'result-title fail';
            }

            resultText.textContent = text;
            overlay.classList.add('show');
        }

        // ä¸‹ä¸€å…³
        function nextLevel() {
            // å…ˆå…³é—­ç»“æœå¼¹çª—
            document.getElementById('result-overlay').classList.remove('show');

            // æ£€æŸ¥æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€å…³
            if (currentLevel + 1 < LEVELS_DATA.length) {
                // è¿›å…¥ä¸‹ä¸€å…³
                currentLevel++;
                localStorage.setItem('currentLevel', currentLevel);

                setTimeout(() => {
                    showFeedback('ğŸ‰', 'å…³å¡å®Œæˆ',
                        `æ­å–œé€šè¿‡å…³å¡${currentLevel}ï¼\n\nå‡†å¤‡è¿›å…¥ä¸‹ä¸€å…³...\n\nç‚¹å‡»"æ˜ç™½äº†"ç»§ç»­`,
                        '');
                    shouldRestartAfterFeedback = true;
                }, 300);
            } else {
                // æ‰€æœ‰å…³å¡å®Œæˆ
                setTimeout(() => {
                    showFeedback('ğŸ‘‘', 'å…¨éƒ¨é€šå…³',
                        'æ­å–œï¼ä½ å·²é€šè¿‡æ‰€æœ‰10å…³æŒ‘æˆ˜ï¼\n\nä½ å·²ç»æ˜¯çœŸæ­£çš„å¢é•¿é»‘å®¢å¤§å¸ˆï¼\n\nç‚¹å‡»"æ˜ç™½äº†"é‡æ–°å¼€å§‹ç¬¬ä¸€å…³',
                        '');
                    shouldRestartAfterFeedback = true;
                    currentLevel = 0;
                    localStorage.setItem('currentLevel', '0');
                }, 300);
            }
        }

        // é‡æ–°å¼€å§‹
        function restart() {
            location.reload();
        }

        // ç‚¹å‡»æƒ…æŠ¥é¡¹ç›®é‡æ–°æŸ¥çœ‹
        function reviewIntel(actionId) {
            showActionFeedback(actionId);
        }

        // æ¸¸æˆå¼€å§‹æ ‡å¿—
        let gameStarted = false;

        // é¡µé¢åŠ è½½æ—¶å¯åŠ¨
        window.addEventListener('DOMContentLoaded', () => {
            // åˆå§‹åŒ–å…³å¡
            initLevel();

            // æ£€æŸ¥æ˜¯å¦éœ€è¦æ–°æ‰‹å¼•å¯¼
            const hasCompletedOnboarding = localStorage.getItem('onboarding_completed') === 'true';

            if (!hasCompletedOnboarding) {
                // é¦–æ¬¡è¿›å…¥ï¼Œå¯åŠ¨æ–°æ‰‹å¼•å¯¼
                console.log('First time user - starting onboarding');

                // å»¶è¿Ÿå¯åŠ¨å¼•å¯¼ï¼Œè®©é¡µé¢å®Œå…¨åŠ è½½
                setTimeout(() => {
                    OnboardingSystem.init();
                }, 500);

                // å¼•å¯¼å®Œæˆåå¯åŠ¨æ¸¸æˆ
                window.onOnboardingComplete = () => {
                    console.log('Onboarding complete - starting game');
                    gameStarted = true;
                    startTimer();
                };
            } else {
                // è€ç©å®¶ç›´æ¥å¼€å§‹
                console.log('Returning user - starting game directly');
                gameStarted = true;
                startTimer();
            }

            // ä¸ºæƒ…æŠ¥åˆ—è¡¨æ·»åŠ ç‚¹å‡»äº‹ä»¶
            document.getElementById('intel-list').addEventListener('click', (e) => {
                const item = e.target.closest('.info-item');
                if (item && item.classList.contains('unlocked')) {
                    const actionId = item.getAttribute('data-action');
                    reviewIntel(actionId);
                }
            });
        });
    </script>
</body>
</html>
