<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>游戏功能测试</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: #0f0;
            padding: 20px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #0f0;
        }
        .pass { color: #0f0; }
        .fail { color: #f00; }
    </style>
</head>
<body>
    <h1>游戏功能测试</h1>
    <div id="results"></div>

    <script src="levels-data.js"></script>
    <script>
        const results = document.getElementById('results');

        function test(name, fn) {
            try {
                fn();
                results.innerHTML += `<div class="test-result pass">✓ ${name}</div>`;
                return true;
            } catch (e) {
                results.innerHTML += `<div class="test-result fail">✗ ${name}: ${e.message}</div>`;
                return false;
            }
        }

        // 测试1: levels-data.js 是否加载
        test('levels-data.js 加载', () => {
            if (typeof LEVELS_DATA === 'undefined') throw new Error('LEVELS_DATA未定义');
            if (!Array.isArray(LEVELS_DATA)) throw new Error('LEVELS_DATA不是数组');
        });

        // 测试2: 关卡数据完整性
        test('关卡数据完整性', () => {
            if (LEVELS_DATA.length !== 3) throw new Error(`期望3个关卡，实际${LEVELS_DATA.length}个`);

            LEVELS_DATA.forEach((level, index) => {
                if (!level.id) throw new Error(`关卡${index}缺少id`);
                if (!level.title) throw new Error(`关卡${index}缺少title`);
                if (!level.objective) throw new Error(`关卡${index}缺少objective`);
                if (!level.timeLimit) throw new Error(`关卡${index}缺少timeLimit`);
                if (!level.scene) throw new Error(`关卡${index}缺少scene`);
                if (!level.actions) throw new Error(`关卡${index}缺少actions`);
                if (!level.questions) throw new Error(`关卡${index}缺少questions`);
            });
        });

        // 测试3: 关卡1的行动数据
        test('关卡1行动数据', () => {
            const level1 = LEVELS_DATA[0];
            if (level1.actions.length !== 6) throw new Error(`期望6个行动，实际${level1.actions.length}个`);

            const requiredActions = ['users', 'finance', 'competitor', 'meeting', 'calc', 'ppt'];
            level1.actions.forEach(action => {
                if (!action.id) throw new Error('行动缺少id');
                if (!action.name) throw new Error('行动缺少name');
                if (!action.time) throw new Error('行动缺少time');
                if (!action.feedback) throw new Error('行动缺少feedback');
            });

            const actionIds = level1.actions.map(a => a.id);
            requiredActions.forEach(id => {
                if (!actionIds.includes(id)) throw new Error(`缺少行动: ${id}`);
            });
        });

        // 测试4: 关卡1的问题数据
        test('关卡1问题数据', () => {
            const level1 = LEVELS_DATA[0];
            if (level1.questions.length !== 3) throw new Error(`期望3个问题，实际${level1.questions.length}个`);

            level1.questions.forEach((q, index) => {
                if (!q.question) throw new Error(`问题${index}缺少question`);
                if (!q.options) throw new Error(`问题${index}缺少options`);
                if (q.options.length !== 4) throw new Error(`问题${index}应该有4个选项`);

                let hasCorrect = false;
                q.options.forEach(opt => {
                    if (!opt.text) throw new Error(`问题${index}的选项缺少text`);
                    if (!opt.feedback) throw new Error(`问题${index}的选项缺少feedback`);
                    if (opt.correct === true) hasCorrect = true;
                });

                if (!hasCorrect) throw new Error(`问题${index}没有正确答案`);
            });
        });

        // 测试5: 关卡2数据
        test('关卡2数据', () => {
            const level2 = LEVELS_DATA[1];
            if (!level2) throw new Error('关卡2不存在');
            if (level2.id !== 2) throw new Error('关卡2 ID错误');
            if (level2.actions.length !== 6) throw new Error(`关卡2应该有6个行动，实际${level2.actions.length}个`);
            if (level2.questions.length !== 3) throw new Error(`关卡2应该有3个问题，实际${level2.questions.length}个`);
        });

        // 测试6: 关卡3数据
        test('关卡3数据', () => {
            const level3 = LEVELS_DATA[2];
            if (!level3) throw new Error('关卡3不存在');
            if (level3.id !== 3) throw new Error('关卡3 ID错误');
            if (level3.actions.length !== 6) throw new Error(`关卡3应该有6个行动，实际${level3.actions.length}个`);
            if (level3.questions.length !== 3) throw new Error(`关卡3应该有3个问题，实际${level3.questions.length}个`);
        });

        // 测试7: 时间限制
        test('时间限制设置', () => {
            if (LEVELS_DATA[0].timeLimit !== 180) throw new Error('关卡1时间应为180分钟');
            if (LEVELS_DATA[1].timeLimit !== 240) throw new Error('关卡2时间应为240分钟');
            if (LEVELS_DATA[2].timeLimit !== 360) throw new Error('关卡3时间应为360分钟');
        });

        // 测试8: 关键行动标记
        test('关键行动标记', () => {
            LEVELS_DATA.forEach((level, index) => {
                const criticalActions = level.actions.filter(a => a.critical);
                if (criticalActions.length < 2) {
                    throw new Error(`关卡${index + 1}关键行动太少`);
                }
            });
        });

        results.innerHTML += '<hr><h2>测试总结</h2>';
        results.innerHTML += '<div class="test-result pass">所有基础测试通过！</div>';
    </script>
</body>
</html>
