<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èµ„æºä¸äº‹ä»¶ç³»ç»Ÿæ¼”ç¤º | Resource & Event System Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #0F172A 0%, #020617 100%);
            color: #E2E8F0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #1E293B 0%, #0F172A 100%);
            border-radius: 15px;
            border: 2px solid #A855F7;
        }

        .header h1 {
            color: #FFD700;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            color: #C9A961;
            font-size: 1em;
        }

        .demo-grid {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .panel {
            background: linear-gradient(135deg, #2C1810 0%, #1A0F0A 100%);
            border: 2px solid #C9A961;
            border-radius: 15px;
            padding: 25px;
        }

        .panel-title {
            color: #FFD700;
            font-size: 1.3em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #C9A961;
            text-align: center;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-label {
            display: block;
            color: #E8DCC4;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .control-btn {
            width: 100%;
            background: linear-gradient(135deg, #A855F7 0%, #7C3AED 100%);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 8px;
            transition: all 0.3s;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(168, 85, 247, 0.5);
        }

        .control-btn.danger {
            background: linear-gradient(135deg, #FF4444 0%, #CC0000 100%);
        }

        .control-btn.success {
            background: linear-gradient(135deg, #4AFF4A 0%, #00CC00 100%);
        }

        .control-btn.warning {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #000;
        }

        .info-box {
            background: rgba(168, 85, 247, 0.1);
            border: 1px solid #A855F7;
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
            font-size: 0.85em;
            line-height: 1.6;
        }

        .resource-panel {
            background: rgba(0,0,0,0.3);
            border: 2px solid #C9A961;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .resource-title {
            color: #FFD700;
            font-size: 1.1em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #C9A961;
            text-align: center;
        }

        .resource-bars {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .resource-item {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .resource-item.critical {
            border: 2px solid #FF4444;
            animation: warning-pulse 1s infinite;
        }

        .resource-item.empty {
            border: 2px solid #8B0000;
            opacity: 0.6;
        }

        @keyframes warning-pulse {
            0%, 100% { box-shadow: 0 0 5px rgba(255,68,68,0.5); }
            50% { box-shadow: 0 0 15px rgba(255,68,68,1); }
        }

        .resource-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .resource-label {
            font-size: 0.9em;
            color: #E8DCC4;
        }

        .resource-value {
            font-size: 1em;
            font-weight: bold;
            color: #FFD700;
        }

        .resource-bar-container {
            width: 100%;
            height: 8px;
            background: rgba(0,0,0,0.5);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 4px;
        }

        .resource-bar {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .resource-hint {
            font-size: 0.75em;
            color: #C9A961;
            opacity: 0.7;
        }

        .log-panel {
            background: rgba(0,0,0,0.5);
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .log-entry {
            padding: 8px;
            margin-bottom: 5px;
            border-left: 3px solid #A855F7;
            background: rgba(168, 85, 247, 0.1);
            border-radius: 4px;
            font-size: 0.85em;
            line-height: 1.4;
        }

        .log-entry.success {
            border-left-color: #4AFF4A;
            background: rgba(74, 255, 74, 0.1);
        }

        .log-entry.warning {
            border-left-color: #FFD700;
            background: rgba(255, 215, 0, 0.1);
        }

        .log-entry.error {
            border-left-color: #FF4444;
            background: rgba(255, 68, 68, 0.1);
        }

        /* äº‹ä»¶ç³»ç»Ÿæ ·å¼ */
        .event-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .event-overlay.show {
            display: flex;
            opacity: 1;
        }

        .event-modal {
            background: linear-gradient(135deg, #2C1810 0%, #1A0F0A 100%);
            border: 3px solid #C9A961;
            border-radius: 20px;
            max-width: 700px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modal-appear 0.5s;
        }

        @keyframes modal-appear {
            from {
                transform: scale(0.8) translateY(-50px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .event-header {
            padding: 30px;
            text-align: center;
            border-bottom: 2px solid #C9A961;
        }

        .event-header.opportunity {
            background: linear-gradient(135deg, rgba(74,255,74,0.1) 0%, transparent 100%);
            border-bottom-color: #4AFF4A;
        }

        .event-header.crisis {
            background: linear-gradient(135deg, rgba(255,68,68,0.1) 0%, transparent 100%);
            border-bottom-color: #FF4444;
        }

        .event-header.milestone {
            background: linear-gradient(135deg, rgba(255,215,0,0.1) 0%, transparent 100%);
            border-bottom-color: #FFD700;
        }

        .event-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .event-type-badge {
            display: inline-block;
            padding: 5px 15px;
            background: rgba(201,169,97,0.3);
            border: 1px solid #C9A961;
            border-radius: 20px;
            font-size: 0.85em;
            margin-bottom: 10px;
        }

        .event-title {
            font-size: 1.8em;
            color: #FFD700;
            font-weight: bold;
        }

        .event-body {
            padding: 30px;
        }

        .event-description {
            font-size: 1.1em;
            line-height: 1.8;
            margin-bottom: 20px;
        }

        .event-context {
            background: rgba(201,169,97,0.1);
            padding: 15px;
            border-radius: 10px;
            border-left: 3px solid #C9A961;
            margin-bottom: 25px;
        }

        .choices-title {
            font-size: 1.2em;
            color: #FFD700;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .event-choice {
            background: linear-gradient(135deg, #3A2010 0%, #2A1810 100%);
            border: 2px solid #8B7355;
            padding: 18px;
            border-radius: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .event-choice:hover {
            border-color: #FFD700;
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(255,215,0,0.3);
        }

        .choice-header {
            margin-bottom: 10px;
        }

        .choice-label {
            font-weight: bold;
            color: #FFD700;
            margin-right: 8px;
        }

        .choice-cost {
            font-size: 0.85em;
            color: #FF8844;
            margin-bottom: 5px;
        }

        .choice-success-rate {
            font-size: 0.85em;
            color: #4AFF4A;
        }

        .event-outcome {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #2C1810 0%, #1A0F0A 100%);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .outcome-icon {
            font-size: 5em;
            margin-bottom: 20px;
        }

        .outcome-title {
            font-size: 2.5em;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 20px;
        }

        .outcome-text {
            font-size: 1.2em;
            line-height: 1.8;
            text-align: center;
            margin-bottom: 30px;
        }

        .outcome-close {
            background: linear-gradient(135deg, #C9A961 0%, #A08040 100%);
            color: #000;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
        }

        @media (max-width: 968px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š èµ„æºä¸äº‹ä»¶ç³»ç»Ÿæ¼”ç¤º</h1>
            <p>Resource & Event System Demo - æµ‹è¯•æ ¸å¿ƒç»è¥æ¨¡æ‹Ÿç³»ç»Ÿ</p>
        </div>

        <div class="demo-grid">
            <!-- æ§åˆ¶é¢æ¿ -->
            <div class="panel">
                <div class="panel-title">ğŸ® æ§åˆ¶é¢æ¿</div>

                <div class="control-group">
                    <div class="control-label">èµ„æºæ“ä½œ</div>
                    <button class="control-btn danger" onclick="testConsumeResource()">
                        æ¶ˆè€—èµ„æºï¼ˆç°é‡‘-1000ï¼‰
                    </button>
                    <button class="control-btn success" onclick="testGainResource()">
                        å¢åŠ èµ„æºï¼ˆä¿¡ä»»+10ï¼‰
                    </button>
                    <button class="control-btn warning" onclick="testCriticalResource()">
                        è®¾ç½®ä¸´ç•Œå€¼ï¼ˆç°é‡‘=1500ï¼‰
                    </button>
                    <button class="control-btn danger" onclick="testEmptyResource()">
                        è€—å°½èµ„æºï¼ˆç²¾åŠ›=0ï¼‰
                    </button>
                </div>

                <div class="control-group">
                    <div class="control-label">äº‹ä»¶æ“ä½œ</div>
                    <button class="control-btn" onclick="testTriggerEvent()">
                        è§¦å‘éšæœºäº‹ä»¶
                    </button>
                    <button class="control-btn success" onclick="testOpportunityEvent()">
                        è§¦å‘æœºä¼šäº‹ä»¶
                    </button>
                    <button class="control-btn danger" onclick="testCrisisEvent()">
                        è§¦å‘å±æœºäº‹ä»¶
                    </button>
                    <button class="control-btn warning" onclick="testMilestoneEvent()">
                        è§¦å‘é‡Œç¨‹ç¢‘äº‹ä»¶
                    </button>
                </div>

                <div class="control-group">
                    <div class="control-label">ç³»ç»Ÿæ“ä½œ</div>
                    <button class="control-btn" onclick="showResourceHistory()">
                        æŸ¥çœ‹èµ„æºå†å²
                    </button>
                    <button class="control-btn" onclick="showEventHistory()">
                        æŸ¥çœ‹äº‹ä»¶å†å²
                    </button>
                    <button class="control-btn danger" onclick="resetAll()">
                        é‡ç½®æ‰€æœ‰ç³»ç»Ÿ
                    </button>
                </div>

                <div class="info-box">
                    ğŸ’¡ <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
                    1. ç‚¹å‡»æŒ‰é’®æµ‹è¯•å„ç§åŠŸèƒ½<br>
                    2. è§‚å¯Ÿå³ä¾§èµ„æºæ¡å˜åŒ–<br>
                    3. äº‹ä»¶ä¼šå¼¹çª—æ˜¾ç¤º<br>
                    4. æ—¥å¿—é¢æ¿è®°å½•æ‰€æœ‰æ“ä½œ
                </div>
            </div>

            <!-- ä¸»æ˜¾ç¤ºåŒº -->
            <div>
                <!-- èµ„æºæ˜¾ç¤º -->
                <div id="resource-container"></div>

                <!-- æ—¥å¿—é¢æ¿ -->
                <div class="panel">
                    <div class="panel-title">ğŸ“ æ“ä½œæ—¥å¿—</div>
                    <div class="log-panel" id="log-panel">
                        <div class="log-entry">ç³»ç»Ÿå·²åˆå§‹åŒ–ï¼Œå‡†å¤‡å°±ç»ªã€‚</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- åŠ è½½ç³»ç»Ÿ -->
    <script src="resource-system.js"></script>
    <script src="event-system.js"></script>

    <script>
        // åˆå§‹åŒ–ç³»ç»Ÿ
        let resourceSystem = new ResourceSystem();
        let resourceUI = new ResourceUI(resourceSystem, 'resource-container');
        let eventSystem = new EventSystem(resourceSystem);
        let eventUI = new EventUI(eventSystem, 'event-overlay-demo');

        // æ—¥å¿—ç³»ç»Ÿ
        function addLog(message, type = 'info') {
            const logPanel = document.getElementById('log-panel');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logPanel.insertBefore(entry, logPanel.firstChild);

            // é™åˆ¶æ—¥å¿—æ•°é‡
            while (logPanel.children.length > 20) {
                logPanel.removeChild(logPanel.lastChild);
            }
        }

        // ç›‘å¬èµ„æºå˜åŒ–
        resourceSystem.on('onChange', (data) => {
            addLog(`${data.resource.name}å˜åŒ–: ${data.oldValue} â†’ ${data.newValue} (${data.change > 0 ? '+' : ''}${data.change})`, 'info');
        });

        resourceSystem.on('onCritical', (data) => {
            addLog(`âš ï¸ ${data.resource.name}å·²è¾¾ä¸´ç•Œå€¼ï¼å½“å‰: ${data.value}`, 'warning');
        });

        resourceSystem.on('onEmpty', (data) => {
            addLog(`ğŸš¨ ${data.resource.name}å·²è€—å°½ï¼`, 'error');
        });

        // ç›‘å¬äº‹ä»¶
        eventSystem.on('onEventTrigger', (event) => {
            addLog(`ğŸ² è§¦å‘äº‹ä»¶: ${event.title}`, 'success');
        });

        eventSystem.on('onChoiceMade', (data) => {
            const result = data.isSuccess ? 'æˆåŠŸ' : 'å¤±è´¥';
            addLog(`âœ… é€‰æ‹©å®Œæˆ: ${data.choice.text} - ${result}`, data.isSuccess ? 'success' : 'warning');
        });

        // æµ‹è¯•å‡½æ•°
        function testConsumeResource() {
            const success = resourceSystem.consume('cash', 1000, 'æµ‹è¯•æ¶ˆè€—');
            if (!success) {
                addLog('ç°é‡‘ä¸è¶³ï¼Œæ— æ³•æ¶ˆè€—ï¼', 'error');
            }
        }

        function testGainResource() {
            resourceSystem.gain('trust', 10, 'æµ‹è¯•å¢åŠ ');
        }

        function testCriticalResource() {
            resourceSystem.set('cash', 1500, 'æµ‹è¯•ä¸´ç•Œå€¼');
        }

        function testEmptyResource() {
            resourceSystem.set('energy', 0, 'æµ‹è¯•è€—å°½');
        }

        function testTriggerEvent() {
            eventSystem.setTriggerProbability(1.0);
            const event = eventSystem.tryTriggerEvent();
            if (!event) {
                addLog('æ²¡æœ‰å¯ç”¨äº‹ä»¶', 'warning');
            }
            eventSystem.setTriggerProbability(0.3);
        }

        function testOpportunityEvent() {
            const event = eventSystem.events.find(e => e.type === 'opportunity');
            if (event) {
                eventSystem.activeEvent = JSON.parse(JSON.stringify(event));
                eventUI.show(eventSystem.activeEvent);
            }
        }

        function testCrisisEvent() {
            const event = eventSystem.events.find(e => e.type === 'crisis');
            if (event) {
                eventSystem.activeEvent = JSON.parse(JSON.stringify(event));
                eventUI.show(eventSystem.activeEvent);
            }
        }

        function testMilestoneEvent() {
            const event = eventSystem.events.find(e => e.type === 'milestone');
            if (event) {
                eventSystem.activeEvent = JSON.parse(JSON.stringify(event));
                eventUI.show(eventSystem.activeEvent);
            }
        }

        function showResourceHistory() {
            const history = resourceSystem.getHistory(null, 10);
            addLog('=== èµ„æºå†å²ï¼ˆæœ€è¿‘10æ¡ï¼‰===', 'info');
            history.forEach(h => {
                addLog(`${h.type}: ${h.oldValue} â†’ ${h.newValue} (${h.reason})`, 'info');
            });
        }

        function showEventHistory() {
            const history = eventSystem.getHistory(10);
            addLog('=== äº‹ä»¶å†å²ï¼ˆæœ€è¿‘10æ¡ï¼‰===', 'info');
            history.forEach(h => {
                addLog(`${h.eventTitle} - ${h.choiceText}: ${h.isSuccess ? 'æˆåŠŸ' : 'å¤±è´¥'}`, 'info');
            });
        }

        function resetAll() {
            resourceSystem.reset();
            eventSystem.reset();
            addLog('ç³»ç»Ÿå·²é‡ç½®', 'success');
        }

        // åˆå§‹åŒ–æ—¥å¿—
        addLog('âœ¨ ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ', 'success');
        addLog('ğŸ“Š èµ„æºç³»ç»Ÿå·²å°±ç»ªï¼Œ5ç§èµ„æºå¯ç”¨', 'info');
        addLog('ğŸ² äº‹ä»¶ç³»ç»Ÿå·²å°±ç»ªï¼Œ5ä¸ªç¤ºä¾‹äº‹ä»¶å·²åŠ è½½', 'info');
    </script>
</body>
</html>
