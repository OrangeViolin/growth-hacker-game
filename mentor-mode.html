<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¢é•¿é»‘å®¢å¯¼å¸ˆæ¨¡å¼ | Growth Hacker Mentor Mode</title>
    <link rel="stylesheet" href="elegant-game.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Georgia, 'Source Han Serif SC', 'Noto Serif SC', serif;
            background: linear-gradient(135deg, #E8DCC4 0%, #D4C4AB 100%);
            min-height: 100vh;
            padding: 20px;
            color: #8B7355;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* é¡¶éƒ¨æ ‡é¢˜ */
        .header {
            background: linear-gradient(135deg, #C9A961 0%, #A0937C 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(139, 115, 85, 0.2);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header .subtitle {
            font-size: 1.1em;
            opacity: 0.95;
        }

        /* ä¸»è¦æ¸¸æˆåŒºåŸŸ */
        .game-area {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
        }

        /* å·¦ä¾§æŒ‘æˆ˜åŒº */
        .challenge-section {
            background: #F5F0E8;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(139, 115, 85, 0.15);
        }

        .challenge-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #D4C4AB;
        }

        .challenge-title {
            font-size: 1.8em;
            color: #C9A961;
        }

        .challenge-difficulty {
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .difficulty-easy { background: #E8F5E9; color: #2E7D32; }
        .difficulty-medium { background: #FFF3E0; color: #E65100; }
        .difficulty-hard { background: #FFEBEE; color: #C62828; }
        .difficulty-expert { background: #E1BEE7; color: #6A1B9A; }

        /* æŒ‘æˆ˜å†…å®¹ */
        .challenge-content {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border-left: 4px solid #C9A961;
            line-height: 1.8;
        }

        .challenge-scenario {
            font-size: 1.05em;
            margin-bottom: 20px;
            white-space: pre-wrap;
        }

        .challenge-requirements {
            background: #FFF9E6;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .challenge-requirements h4 {
            color: #C9A961;
            margin-bottom: 10px;
        }

        .challenge-requirements ul {
            margin-left: 20px;
        }

        .challenge-requirements li {
            margin: 5px 0;
        }

        /* ç­”é¢˜åŒº */
        .answer-section {
            margin-top: 25px;
        }

        .answer-textarea {
            width: 100%;
            min-height: 300px;
            padding: 20px;
            border: 2px solid #D4C4AB;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 1em;
            line-height: 1.6;
            resize: vertical;
            background: white;
        }

        .answer-textarea:focus {
            outline: none;
            border-color: #C9A961;
            box-shadow: 0 0 0 3px rgba(201, 169, 97, 0.1);
        }

        .answer-actions {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            align-items: center;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.05em;
            cursor: pointer;
            transition: all 0.3s;
            font-family: Georgia, serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, #C9A961 0%, #A0937C 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(201, 169, 97, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(201, 169, 97, 0.4);
        }

        .btn-secondary {
            background: #E8DCC4;
            color: #8B7355;
        }

        .btn-secondary:hover {
            background: #D4C4AB;
        }

        .hint-info {
            color: #A0937C;
            font-size: 0.9em;
        }

        /* å³ä¾§çŠ¶æ€é¢æ¿ */
        .status-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .panel-card {
            background: #F5F0E8;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(139, 115, 85, 0.15);
        }

        .panel-card h3 {
            color: #C9A961;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #D4C4AB;
            padding-bottom: 10px;
        }

        /* è¿›åº¦æ¡ */
        .progress-bar-container {
            background: #E8DCC4;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #C9A961 0%, #8B7355 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: width 0.5s ease;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #E8DCC4;
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #A0937C;
        }

        .stat-value {
            font-weight: bold;
            color: #8B7355;
        }

        /* ç­‰çº§å¾½ç«  */
        .grade-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .grade-A-plus { background: #FFD700; color: #8B7355; }
        .grade-A { background: #90EE90; color: #2E7D32; }
        .grade-B { background: #87CEEB; color: #0D47A1; }
        .grade-C { background: #FFA500; color: white; }
        .grade-F { background: #FF6347; color: white; }

        /* å¯¼å¸ˆåé¦ˆåŒº */
        .mentor-feedback {
            background: white;
            padding: 25px;
            border-radius: 12px;
            border-left: 4px solid #C9A961;
            margin-top: 25px;
            display: none;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .mentor-feedback.show {
            display: block;
        }

        .feedback-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .mentor-avatar {
            font-size: 3em;
        }

        .feedback-title {
            font-size: 1.5em;
            color: #C9A961;
        }

        .feedback-score {
            margin-left: auto;
            font-size: 2em;
            font-weight: bold;
            color: #8B7355;
        }

        .feedback-content {
            line-height: 1.8;
            margin: 15px 0;
        }

        .feedback-breakdown {
            background: #FFF9E6;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #E8DCC4;
        }

        .breakdown-item:last-child {
            border-bottom: none;
        }

        .hint-box {
            background: #E3F2FD;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #2196F3;
            margin-top: 15px;
        }

        .hint-box h4 {
            color: #1976D2;
            margin-bottom: 10px;
        }

        /* å…³å¡åˆ—è¡¨ */
        .challenge-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .challenge-item {
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .challenge-item:hover {
            background: #E8DCC4;
        }

        .challenge-item.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .challenge-item.completed {
            background: #E8F5E9;
        }

        .challenge-item.current {
            background: #FFF3E0;
            border: 2px solid #C9A961;
        }

        /* å®šæ—¶å™¨ */
        .timer {
            font-size: 1.5em;
            font-weight: bold;
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 12px;
        }

        .timer.warning {
            background: #FFEBEE;
            color: #C62828;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* å“åº”å¼ */
        @media (max-width: 1200px) {
            .game-area {
                grid-template-columns: 1fr;
            }

            .status-panel {
                flex-direction: row;
                flex-wrap: wrap;
            }

            .panel-card {
                flex: 1;
                min-width: 300px;
            }
        }

        /* æˆåŠŸ/å¤±è´¥æç¤º */
        .result-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .result-overlay.show {
            display: flex;
        }

        .result-box {
            background: white;
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            animation: scaleIn 0.5s;
        }

        @keyframes scaleIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .result-icon {
            font-size: 5em;
            margin-bottom: 20px;
        }

        .result-title {
            font-size: 2em;
            margin-bottom: 15px;
            color: #8B7355;
        }

        .result-message {
            font-size: 1.2em;
            margin-bottom: 30px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨æ ‡é¢˜ -->
        <div class="header">
            <h1>ğŸ“ å¢é•¿é»‘å®¢å¯¼å¸ˆæ¨¡å¼</h1>
            <p class="subtitle">Growth Hacker Mentor Mode - ä¸¥æ ¼é—¯å…³ï¼ŒçœŸæ­£æŒæ¡</p>
        </div>

        <!-- ä¸»æ¸¸æˆåŒºåŸŸ -->
        <div class="game-area">
            <!-- å·¦ä¾§æŒ‘æˆ˜åŒº -->
            <div class="challenge-section">
                <!-- æŒ‘æˆ˜æ ‡é¢˜ -->
                <div class="challenge-header">
                    <div>
                        <div class="challenge-title" id="challenge-title">ç¬¬1å…³ï¼šLTVåŸºç¡€è®¡ç®—</div>
                        <div style="color: #A0937C; margin-top: 5px;">Challenge 1: LTV Basics</div>
                    </div>
                    <span class="challenge-difficulty difficulty-easy" id="challenge-difficulty">ç®€å• Easy</span>
                </div>

                <!-- æŒ‘æˆ˜å†…å®¹ -->
                <div class="challenge-content" id="challenge-content">
                    <div class="challenge-scenario" id="challenge-scenario">
æ­£åœ¨åŠ è½½æŒ‘æˆ˜...
                    </div>

                    <div class="challenge-requirements" id="challenge-requirements">
                        <h4>âœ“ ç­”é¢˜è¦æ±‚ï¼š</h4>
                        <ul id="requirements-list">
                            <li>æ˜¾ç¤ºå®Œæ•´è®¡ç®—è¿‡ç¨‹</li>
                            <li>è§£é‡Šæ¯ä¸ªå˜é‡çš„å«ä¹‰</li>
                            <li>ç»™å‡ºæœ€ç»ˆç­”æ¡ˆ</li>
                        </ul>
                    </div>
                </div>

                <!-- ç­”é¢˜åŒº -->
                <div class="answer-section">
                    <h3 style="margin-bottom: 15px; color: #C9A961;">ğŸ“ ä½ çš„ç­”æ¡ˆï¼š</h3>
                    <textarea
                        class="answer-textarea"
                        id="user-answer"
                        placeholder="åœ¨è¿™é‡Œè¾“å…¥ä½ çš„ç­”æ¡ˆ...

è¯·åŒ…å«ï¼š
1. å®Œæ•´çš„è®¡ç®—è¿‡ç¨‹
2. ä½¿ç”¨çš„å…¬å¼
3. æ¯ä¸€æ­¥çš„æ¨ç†
4. æœ€ç»ˆç­”æ¡ˆ

ç¤ºä¾‹ï¼š
LTV = ARPU Ã— å¹³å‡ç•™å­˜æœˆæ•° Ã— Gross Margin
   = $50 Ã— 12 Ã— 0.7
   = $420

å› ä¸º...
"></textarea>

                    <div class="answer-actions">
                        <button class="btn btn-primary" onclick="submitAnswer()">
                            âš¡ æäº¤ç­”æ¡ˆ
                        </button>
                        <button class="btn btn-secondary" onclick="requestHint()">
                            ğŸ’¡ éœ€è¦æç¤º (<span id="hints-remaining">3</span>)
                        </button>
                        <span class="hint-info">
                            â±ï¸ å‰©ä½™æ—¶é—´: <span id="timer-display">10:00</span>
                        </span>
                    </div>
                </div>

                <!-- å¯¼å¸ˆåé¦ˆ -->
                <div class="mentor-feedback" id="mentor-feedback">
                    <div class="feedback-header">
                        <div class="mentor-avatar">ğŸ¤–</div>
                        <div>
                            <div class="feedback-title">å¯¼å¸ˆè¯„ä»· Mentor Feedback</div>
                            <div style="color: #A0937C; font-size: 0.9em;">Growth Hacking Mentor</div>
                        </div>
                        <div class="feedback-score" id="feedback-score">--</div>
                    </div>

                    <div class="feedback-content" id="feedback-text">
                        ç­‰å¾…è¯„åˆ†...
                    </div>

                    <div class="feedback-breakdown" id="feedback-breakdown">
                        <h4 style="margin-bottom: 10px; color: #C9A961;">ğŸ“Š è¯„åˆ†ç»†èŠ‚ï¼š</h4>
                        <div class="breakdown-item">
                            <span>æ•°æ®å‡†ç¡®æ€§ (30åˆ†)</span>
                            <span id="score-data">--</span>
                        </div>
                        <div class="breakdown-item">
                            <span>é€»è¾‘å®Œæ•´æ€§ (25åˆ†)</span>
                            <span id="score-logic">--</span>
                        </div>
                        <div class="breakdown-item">
                            <span>è®¡ç®—å‡†ç¡®æ€§ (20åˆ†)</span>
                            <span id="score-calc">--</span>
                        </div>
                        <div class="breakdown-item">
                            <span>æ¦‚å¿µç†è§£ (15åˆ†)</span>
                            <span id="score-concept">--</span>
                        </div>
                        <div class="breakdown-item">
                            <span>ç­–ç•¥å¯è¡Œæ€§ (10åˆ†)</span>
                            <span id="score-strategy">--</span>
                        </div>
                        <div class="breakdown-item" style="border-top: 2px solid #C9A961; margin-top: 10px; padding-top: 10px; font-weight: bold;">
                            <span>æ€»åˆ† Total</span>
                            <span id="score-total">--/100</span>
                        </div>
                    </div>

                    <div id="hint-container"></div>

                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-primary" onclick="nextChallenge()" id="next-button" style="display: none;">
                            â¡ï¸ ä¸‹ä¸€å…³ Next Challenge
                        </button>
                        <button class="btn btn-secondary" onclick="retryChallenge()" id="retry-button" style="display: none;">
                            ğŸ”„ é‡è¯• Retry
                        </button>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§çŠ¶æ€é¢æ¿ -->
            <div class="status-panel">
                <!-- è¿›åº¦å¡ç‰‡ -->
                <div class="panel-card">
                    <h3>ğŸ“ˆ å­¦ä¹ è¿›åº¦</h3>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="overall-progress" style="width: 2%;">
                            1 / 50
                        </div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">å½“å‰å…³å¡</span>
                        <span class="stat-value" id="current-level">1</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">å·²å®Œæˆ</span>
                        <span class="stat-value" id="completed-count">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">å¹³å‡åˆ†æ•°</span>
                        <span class="stat-value" id="average-score">--</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">å½“å‰ç­‰çº§</span>
                        <span class="stat-value grade-badge" id="current-grade">åˆå­¦è€…</span>
                    </div>
                </div>

                <!-- ç»Ÿè®¡å¡ç‰‡ -->
                <div class="panel-card">
                    <h3>ğŸ“Š ç­”é¢˜ç»Ÿè®¡</h3>
                    <div class="stat-item">
                        <span class="stat-label">å°è¯•æ¬¡æ•°</span>
                        <span class="stat-value" id="attempt-count">0 / 3</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">å‰©ä½™æç¤º</span>
                        <span class="stat-value" id="hint-count">3</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ç”¨æ—¶</span>
                        <span class="stat-value" id="time-spent">00:00</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">è¿èƒœ</span>
                        <span class="stat-value" id="win-streak">0</span>
                    </div>
                </div>

                <!-- æˆå°±å¡ç‰‡ -->
                <div class="panel-card">
                    <h3>ğŸ† æˆå°±è§£é”</h3>
                    <div id="achievements-list">
                        <div style="text-align: center; color: #A0937C; padding: 20px;">
                            å®ŒæˆæŒ‘æˆ˜è§£é”æˆå°±
                        </div>
                    </div>
                </div>

                <!-- å…³å¡åˆ—è¡¨ -->
                <div class="panel-card">
                    <h3>ğŸ¯ å…³å¡åˆ—è¡¨</h3>
                    <div class="challenge-list" id="challenge-list">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç»“æœå¼¹çª— -->
    <div class="result-overlay" id="result-overlay">
        <div class="result-box">
            <div class="result-icon" id="result-icon">ğŸ‰</div>
            <div class="result-title" id="result-title">æ­å–œé€šå…³ï¼</div>
            <div class="result-message" id="result-message">ä½ å·²ç»æŒæ¡äº†è¿™ä¸ªçŸ¥è¯†ç‚¹ï¼</div>
            <button class="btn btn-primary" onclick="closeResultOverlay()">ç»§ç»­</button>
        </div>
    </div>

    <!-- å¼•å…¥æ‰€æœ‰ç³»ç»Ÿæ–‡ä»¶ -->
    <script src="ai-mentor-system.js"></script>
    <script src="knowledge-base.js"></script>
    <script src="mentor-dialogue-templates.js"></script>
    <script src="challenge-system.js"></script>
    <script src="difficulty-engine.js"></script>
    <script src="validation-rules.js"></script>
    <script src="growth-hacking-curriculum.js"></script>
    <script src="real-case-studies.js"></script>
    <script src="common-mistakes-db.js"></script>

    <script>
        // æ¸¸æˆçŠ¶æ€
        let mentorSystem;
        let challengeSystem;
        let difficultyEngine;
        let currentChallenge;
        let currentChallengeId = 'calc_001_ltv_basic';
        let attemptCount = 0;
        let hintsUsed = 0;
        let startTime;
        let timerInterval;
        let gameProgress = {
            completedChallenges: [],
            scores: [],
            totalAttempts: 0,
            winStreak: 0
        };

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            try {
                // åˆå§‹åŒ–ç³»ç»Ÿ
                mentorSystem = new AIMentorSystem();
                challengeSystem = new ChallengeSystem();
                difficultyEngine = new DifficultyEngine();

                console.log('âœ… å¯¼å¸ˆç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ');

                // ç”Ÿæˆå…³å¡åˆ—è¡¨
                generateChallengeList();

                // åŠ è½½ç¬¬ä¸€ä¸ªæŒ‘æˆ˜
                loadChallenge(currentChallengeId);

            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                alert('ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            }
        }

        // ç”Ÿæˆå…³å¡åˆ—è¡¨
        function generateChallengeList() {
            const listContainer = document.getElementById('challenge-list');
            const challenges = challengeSystem.getAllChallenges();

            listContainer.innerHTML = challenges.map((challenge, index) => {
                const isCompleted = gameProgress.completedChallenges.includes(challenge.id);
                const isCurrent = challenge.id === currentChallengeId;
                const isLocked = index > 0 && !gameProgress.completedChallenges.includes(challenges[index - 1].id);

                return `
                    <div class="challenge-item ${isCompleted ? 'completed' : ''} ${isCurrent ? 'current' : ''} ${isLocked ? 'locked' : ''}"
                         onclick="${!isLocked ? `loadChallenge('${challenge.id}')` : ''}">
                        <div>
                            <div style="font-weight: bold;">${index + 1}. ${challenge.title || challenge.name}</div>
                            <div style="font-size: 0.85em; color: #A0937C;">${challenge.difficulty}</div>
                        </div>
                        <div>
                            ${isCompleted ? 'âœ…' : isLocked ? 'ğŸ”’' : 'â­•'}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // åŠ è½½æŒ‘æˆ˜
        function loadChallenge(challengeId) {
            currentChallengeId = challengeId;
            currentChallenge = challengeSystem.getChallenge(challengeId);

            if (!currentChallenge) {
                alert('æŒ‘æˆ˜åŠ è½½å¤±è´¥');
                return;
            }

            // æ›´æ–°UI
            document.getElementById('challenge-title').textContent = currentChallenge.title || currentChallenge.name;
            document.getElementById('challenge-difficulty').textContent = currentChallenge.difficulty;
            document.getElementById('challenge-difficulty').className =
                `challenge-difficulty difficulty-${currentChallenge.difficulty.toLowerCase()}`;
            document.getElementById('challenge-scenario').textContent = currentChallenge.scenario;

            // æ›´æ–°è¦æ±‚åˆ—è¡¨
            const reqList = document.getElementById('requirements-list');
            const requirements = currentChallenge.requirements || [
                'æ˜¾ç¤ºå®Œæ•´è®¡ç®—è¿‡ç¨‹',
                'è§£é‡Šæ¯ä¸ªå˜é‡çš„å«ä¹‰',
                'ç»™å‡ºæœ€ç»ˆç­”æ¡ˆ'
            ];
            reqList.innerHTML = requirements.map(req =>
                `<li>${req}</li>`
            ).join('');

            // é‡ç½®çŠ¶æ€
            attemptCount = 0;
            hintsUsed = 0;
            document.getElementById('user-answer').value = '';
            document.getElementById('mentor-feedback').classList.remove('show');
            document.getElementById('hints-remaining').textContent = 3 - hintsUsed;
            document.getElementById('attempt-count').textContent = `${attemptCount} / 3`;

            // å¯åŠ¨è®¡æ—¶å™¨
            startTimer(currentChallenge.timeLimit || 600);

            // æ›´æ–°å…³å¡åˆ—è¡¨
            generateChallengeList();
        }

        // å¯åŠ¨è®¡æ—¶å™¨
        function startTimer(seconds) {
            if (timerInterval) clearInterval(timerInterval);

            startTime = Date.now();
            let remaining = seconds;

            const updateTimer = () => {
                remaining--;
                const minutes = Math.floor(remaining / 60);
                const secs = remaining % 60;
                document.getElementById('timer-display').textContent =
                    `${minutes}:${secs.toString().padStart(2, '0')}`;

                if (remaining <= 60) {
                    document.getElementById('timer-display').style.color = '#C62828';
                }

                if (remaining <= 0) {
                    clearInterval(timerInterval);
                    alert('æ—¶é—´åˆ°ï¼è¯·æäº¤ç­”æ¡ˆæˆ–ç”³è¯·å»¶æ—¶ã€‚');
                }
            };

            timerInterval = setInterval(updateTimer, 1000);
            updateTimer();
        }

        // æäº¤ç­”æ¡ˆ
        async function submitAnswer() {
            const answer = document.getElementById('user-answer').value.trim();

            if (!answer) {
                alert('è¯·å…ˆè¾“å…¥ç­”æ¡ˆ');
                return;
            }

            if (attemptCount >= 3) {
                alert('å·²è¾¾åˆ°æœ€å¤§å°è¯•æ¬¡æ•°');
                return;
            }

            attemptCount++;
            document.getElementById('attempt-count').textContent = `${attemptCount} / 3`;

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const feedbackEl = document.getElementById('mentor-feedback');
            feedbackEl.classList.add('show');
            document.getElementById('feedback-text').textContent = 'å¯¼å¸ˆæ­£åœ¨æ‰¹æ”¹...';

            try {
                // è°ƒç”¨å¯¼å¸ˆç³»ç»Ÿè¯„ä¼°
                const result = await mentorSystem.evaluateAnswer(answer, currentChallenge);

                // æ˜¾ç¤ºç»“æœ
                displayFeedback(result);

                // æ›´æ–°ç»Ÿè®¡
                gameProgress.totalAttempts++;
                gameProgress.scores.push(result.score);
                updateStats();

            } catch (error) {
                console.error('è¯„ä¼°å¤±è´¥:', error);
                document.getElementById('feedback-text').textContent =
                    'è¯„ä¼°ç³»ç»Ÿé‡åˆ°é”™è¯¯ï¼Œè¯·é‡è¯•';
            }
        }

        // æ˜¾ç¤ºåé¦ˆ
        function displayFeedback(result) {
            // æ˜¾ç¤ºåˆ†æ•°
            document.getElementById('feedback-score').textContent = result.score;

            // æ˜¾ç¤ºç­‰çº§å¾½ç« 
            const gradeClass = `grade-${result.grade.level.replace('+', '-plus')}`;
            document.getElementById('feedback-score').className = `feedback-score grade-badge ${gradeClass}`;

            // æ˜¾ç¤ºåé¦ˆæ–‡æœ¬
            document.getElementById('feedback-text').innerHTML = result.feedback;

            // æ˜¾ç¤ºè¯„åˆ†ç»†èŠ‚
            if (result.breakdown) {
                document.getElementById('score-data').textContent = result.breakdown.dataAccuracy || 0;
                document.getElementById('score-logic').textContent = result.breakdown.logicCompleteness || 0;
                document.getElementById('score-calc').textContent = result.breakdown.calculationCorrect || 0;
                document.getElementById('score-concept').textContent = result.breakdown.conceptUnderstanding || 0;
                document.getElementById('score-strategy').textContent = result.breakdown.feasibility || 0;
                document.getElementById('score-total').textContent = `${result.score}/100`;
            }

            // æ˜¾ç¤ºæç¤ºï¼ˆå¦‚æœæœ‰ï¼‰
            if (result.hint) {
                const hintContainer = document.getElementById('hint-container');
                hintContainer.innerHTML = `
                    <div class="hint-box">
                        <h4>ğŸ’¡ å¯¼å¸ˆæç¤ºï¼š</h4>
                        <div>${result.hint}</div>
                    </div>
                `;
            }

            // æ˜¾ç¤ºæŒ‰é’®
            if (result.grade.pass) {
                // é€šè¿‡
                document.getElementById('next-button').style.display = 'inline-block';
                document.getElementById('retry-button').style.display = 'none';

                // æ›´æ–°è¿›åº¦
                if (!gameProgress.completedChallenges.includes(currentChallengeId)) {
                    gameProgress.completedChallenges.push(currentChallengeId);
                    gameProgress.winStreak++;
                }

                // æ˜¾ç¤ºç»“æœå¼¹çª—
                showResultOverlay(true, result.grade.level, result.score);

            } else if (attemptCount >= 3) {
                // å¤±è´¥
                document.getElementById('next-button').style.display = 'none';
                document.getElementById('retry-button').style.display = 'inline-block';
                gameProgress.winStreak = 0;

                // æ˜¾ç¤ºå¤±è´¥å¼¹çª—
                showResultOverlay(false, 'F', result.score);

            } else {
                // å¯ä»¥ç»§ç»­å°è¯•
                document.getElementById('retry-button').style.display = 'inline-block';
            }
        }

        // è¯·æ±‚æç¤º
        function requestHint() {
            if (hintsUsed >= 3) {
                alert('æç¤ºæ¬¡æ•°å·²ç”¨å®Œ');
                return;
            }

            const hint = mentorSystem.provideClue(hintsUsed + 1, currentChallenge);
            hintsUsed++;

            document.getElementById('hints-remaining').textContent = 3 - hintsUsed;

            // æ˜¾ç¤ºæç¤º
            const hintContainer = document.getElementById('hint-container');
            hintContainer.innerHTML = `
                <div class="hint-box">
                    <h4>ğŸ’¡ å¯¼å¸ˆæç¤º ${hintsUsed}/3ï¼š</h4>
                    <div>${hint.hint || hint.text || 'æ€è€ƒæ–¹å‘ï¼šè¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒæ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿ'}</div>
                    ${hint.keywords ? `<div style="margin-top: 10px;"><strong>å…³é”®è¯ï¼š</strong>${hint.keywords.join(', ')}</div>` : ''}
                </div>
            `;

            document.getElementById('mentor-feedback').classList.add('show');
        }

        // ä¸‹ä¸€å…³
        function nextChallenge() {
            const challenges = challengeSystem.getAllChallenges();
            const currentIndex = challenges.findIndex(c => c.id === currentChallengeId);

            if (currentIndex < challenges.length - 1) {
                loadChallenge(challenges[currentIndex + 1].id);
            } else {
                alert('æ­å–œï¼ä½ å·²å®Œæˆæ‰€æœ‰æŒ‘æˆ˜ï¼');
            }
        }

        // é‡è¯•
        function retryChallenge() {
            loadChallenge(currentChallengeId);
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            const avgScore = gameProgress.scores.length > 0
                ? (gameProgress.scores.reduce((a, b) => a + b, 0) / gameProgress.scores.length).toFixed(1)
                : '--';

            document.getElementById('current-level').textContent = gameProgress.completedChallenges.length + 1;
            document.getElementById('completed-count').textContent = gameProgress.completedChallenges.length;
            document.getElementById('average-score').textContent = avgScore;
            document.getElementById('win-streak').textContent = gameProgress.winStreak;

            const progress = (gameProgress.completedChallenges.length / 50 * 100).toFixed(0);
            document.getElementById('overall-progress').style.width = progress + '%';
            document.getElementById('overall-progress').textContent =
                `${gameProgress.completedChallenges.length} / 50`;

            // æ›´æ–°ç­‰çº§
            let grade = 'åˆå­¦è€…';
            if (avgScore >= 90) grade = 'å¤§å¸ˆ';
            else if (avgScore >= 80) grade = 'ä¸“å®¶';
            else if (avgScore >= 70) grade = 'ç†Ÿç»ƒ';
            document.getElementById('current-grade').textContent = grade;
        }

        // æ˜¾ç¤ºç»“æœå¼¹çª—
        function showResultOverlay(success, grade, score) {
            const overlay = document.getElementById('result-overlay');
            const icon = document.getElementById('result-icon');
            const title = document.getElementById('result-title');
            const message = document.getElementById('result-message');

            if (success) {
                icon.textContent = grade === 'A+' ? 'ğŸ†' : grade === 'A' ? 'ğŸ‰' : 'âœ…';
                title.textContent = grade === 'A+' ? 'å®Œç¾é€šå…³ï¼' : grade === 'A' ? 'ä¼˜ç§€ï¼' : 'é€šè¿‡ï¼';
                message.textContent = `ä½ è·å¾—äº† ${grade} ç­‰çº§ï¼Œå¾—åˆ† ${score} åˆ†ï¼`;
            } else {
                icon.textContent = 'ğŸ˜';
                title.textContent = 'æœªé€šè¿‡';
                message.textContent = `å¾—åˆ† ${score} åˆ†ï¼ˆéœ€è¦70åˆ†åŠæ ¼ï¼‰ã€‚å»ºè®®å¤ä¹ ç›¸å…³çŸ¥è¯†åå†è¯•ã€‚`;
            }

            overlay.classList.add('show');
        }

        // å…³é—­ç»“æœå¼¹çª—
        function closeResultOverlay() {
            document.getElementById('result-overlay').classList.remove('show');
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', initGame);

        // é¡µé¢å¸è½½æ—¶ä¿å­˜è¿›åº¦
        window.addEventListener('beforeunload', () => {
            localStorage.setItem('mentorGameProgress', JSON.stringify(gameProgress));
        });

        // åŠ è½½ä¿å­˜çš„è¿›åº¦
        const savedProgress = localStorage.getItem('mentorGameProgress');
        if (savedProgress) {
            gameProgress = JSON.parse(savedProgress);
        }
    </script>
</body>
</html>
